var P=Object.defineProperty;var _=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var C=(a,t,e)=>t in a?P(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,v=(a,t)=>{for(var e in t||(t={}))D.call(t,e)&&C(a,e,t[e]);if(_)for(var e of _(t))E.call(t,e)&&C(a,e,t[e]);return a};import{r as u,j as r,M as T,b as N}from"./2340486e-n0khdanno9uzbccp.js";import{dm as R,am as A,e8 as b,e$ as k,e_ as w,ds as I,dq as L,dt as O,dA as B,dJ as q,R as U}from"./4813494d-di0bpg5zidu9s57f.js";import{r as Y}from"./b81d67c1-g85xaexv7seu9n1r.js";import{bu as $,bv as F}from"./1a7ebd5f-ihenykhpblfwilpu.js";const y=118;function W(a){var i,d,l,f,p,m;const t=I(a),e=(i=L.getCurrentNode(t))==null?void 0:i.message;if(!e||!H(e)||(d=e.clientMetadata)!=null&&d.autoProceedCancelled||(l=e.metadata)!=null&&l.auto_proceed_cancelled)return!1;const n=Date.now(),s=((f=e.create_time)!=null?f:Date.now()/1e3)*1e3,o=(m=(p=e.metadata)==null?void 0:p.auto_proceed_timeout_seconds)!=null?m:y;return Math.max(0,Math.ceil(o-(n-s)/1e3))>0}function H(a){var t;return!!((t=a.metadata)!=null&&t.n7jupd_message&&a.channel==="commentary"&&a.end_turn===!0)}async function z(a){const t=O(a);if(t)return B(a,e=>{q.updateTree(e,(n,s)=>{n.updateNodeMetadata(s,{autoProceedCancelled:!0})})}),await U.safePost("/conversation/{conversation_id}/agent/cancel_auto_proceed",{parameters:{path:{conversation_id:t}}})}function J(a,t,e){const[n,s]=u.useState(()=>Date.now());u.useEffect(()=>{if(!e)return;const l=setInterval(()=>s(Date.now()),250);return()=>clearInterval(l)},[e]);const o=t-(n-a)/1e3,c=Math.max(0,o),i=Math.ceil(c),d=t===0?1:Math.min(1,Math.max(0,1-c/t));return{secondsDisplay:i,progress:d}}const ee=({lastMessage:a,clientThreadId:t})=>{var m,g,M;const e=R(t),n=u.useRef(((m=a.create_time)!=null?m:Date.now()/1e3)*1e3),s=(M=(g=a.metadata)==null?void 0:g.auto_proceed_timeout_seconds)!=null?M:y,{initialTimeLeft:o}=u.useMemo(()=>{const h=Date.now(),S=n.current,x=Math.ceil(s-(h-S)/1e3),j=(s-x)/s;return{initialTimeLeft:x,initialProgress:j}},[s]),[c,i]=u.useState(!1),{selectedSources:d}=$(e.id),{secondsDisplay:l,progress:f}=J(n.current,s,c||o>0);u.useEffect(()=>{if(o<=0){i(!0);return}const h=setTimeout(()=>i(!0),o*1e3);return()=>clearTimeout(h)},[o]);const p=async()=>{i(!0),await Y({conversation:e,eventSource:"mouse",promptMessage:k("Continue",v({system_hints:[w]},d&&{selected_sources:F(d)})),parentMessageId:a.id,completionMetadata:{systemHints:[w],conversationMode:{kind:b.PrimaryAssistant}}})};return o<-30?null:r.jsx("div",{className:"my-2 flex",children:r.jsxs(A,{onClick:p,disabled:c,className:"relative min-w-32 overflow-hidden px-2 transition-all",contentWrapperClassName:"gap-2",children:[r.jsx("span",{className:"flex items-center gap-1",children:c?r.jsx(T,{id:"clarification.loading",defaultMessage:"Proceeding..."}):r.jsx(T,{id:"clarification.modelContinueMessage",defaultMessage:"Continue"})}),!c&&r.jsx(K,{secondsDisplay:l,progress:f})]})})};function K({secondsDisplay:a,progress:t,size:e=22,strokeWidth:n=2}){const s=(e-n)/2,o=2*Math.PI*s,c=o*(1-t),i=N();return r.jsxs("div",{"aria-label":i.formatMessage({id:"clarification.secondsRemaining",defaultMessage:"{seconds} seconds remaining"},{seconds:a.toString()}),className:"relative inline-flex items-center justify-center",style:{width:e,height:e},children:[r.jsxs("svg",{width:e,height:e,className:"block",children:[r.jsx("circle",{cx:e/2,cy:e/2,r:s,stroke:"currentColor",strokeOpacity:.3,strokeWidth:n,fill:"none"}),r.jsx("circle",{cx:e/2,cy:e/2,r:s,stroke:"currentColor",strokeWidth:n,fill:"none",strokeDasharray:o,strokeDashoffset:c,style:{transition:"stroke-dashoffset 100ms linear"},transform:"rotate(-90 ".concat(e/2," ").concat(e/2,")")})]}),r.jsx("span",{className:"absolute text-[9px] leading-none font-medium",style:{fontVariantNumeric:"tabular-nums"},children:a})]})}export{ee as C,W as a,z as c,H as i};
//# sourceMappingURL=929b8f98-bi5zibmx55zmngs7.js.map
