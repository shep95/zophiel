const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/da554a06-nplzj10vooi0vs4q.js","assets/2340486e-n0khdanno9uzbccp.js","assets/4813494d-di0bpg5zidu9s57f.js","assets/root-jvstnck2.css","assets/1a7ebd5f-ihenykhpblfwilpu.js","assets/conversation-small-dnpfu486.css","assets/1676515f-c99or8zu6nxqpyff.js","assets/fa685806-a2zoho20zrc3hsnw.js","assets/4f2ad7bd-kpwpz7z9ja29bbyl.js","assets/f85a3e0b-gtbeej2oreusa2q4.js","assets/db62250d-eyec17b70eqxu45z.js","assets/089c718c-clpuzb1fnoaty06o.js","assets/b81d67c1-g85xaexv7seu9n1r.js","assets/b9ebfa06-o5t8gt8380co00ia.js","assets/84e8f385-egf9uxe7ipj6bm36.js","assets/019abe50-bh3hd4ysottp48ja.js","assets/d258363e-fj3id6ihusbc00ig.js","assets/88a9106a-nxlu01ukgk52194y.js","assets/18545a31-my0jf4yh4br6vbi1.js","assets/ee5ab530-dw1bf8jzwkws5rg0.js","assets/40838a6b-k3rycw0e5rgubjvf.js","assets/e0921b7a-d80kbpu52j6pqerp.js","assets/c1811d6e-9vuh4tyfttidvn72.js","assets/ecab41d6-dgmrtfpp3h7estm8.js","assets/f90e2400-fr4zdxt4fr9yeysi.js","assets/af004db9-dmwqnmwzjibyeaoe.js","assets/5617653c-ncg1xdaf2s991f2j.js","assets/85f3cacd-h8n70jj6ceahxo3e.js","assets/5eec0dc4-k9otd6tvpibl4qch.js","assets/929b8f98-bi5zibmx55zmngs7.js","assets/28938d3c-ne58pdayq54airr8.js","assets/3c297c26-ggni0grvxxta5v5c.js","assets/6639ec14-ekyw7koprp1owxh0.js","assets/browser-tool-message-cwadkyoy.css","assets/4f2e40fd-cu0afmb5yw4063az.js","assets/495cf45b-b9cc09citdppd763.js","assets/14a60637-bst0vyqakl66pg7g.js","assets/58ab20f4-llkrtw6qvmn5b0mv.js","assets/1c5ccd89-kcf7r6h1kgm8tm4h.js","assets/c8f38d6c-8zibg2wvcxw3wbv6.js","assets/67fb493c-fcjaerar2hhkcfpa.js","assets/f254c486-kwoduz1eb539u93y.js","assets/7517017f-nbqc13l5s6dxfmri.js","assets/679fc303-kl7c6054usfnqmd4.js","assets/8d846022-ns51nblw8ziscsgd.js","assets/781797c9-e3xbbwr7ah8iicik.js","assets/31cec8d8-ce3hgmw4iyyhicud.js","assets/1bc04b52-xt98zj1xgahnmc03.js","assets/2b82192b-k8orr4u13qyx78ry.js","assets/dcbc66ee-b9m14nqh30npsem2.js","assets/a9fa9fda-jv0idfvobhx17h7f.js","assets/a366adf3-ec2lwcsjzq0y9kv1.js","assets/78321319-nf4yeb2chcf12xq9.js","assets/ab492d51-juf3hjupp03irvcd.js","assets/41a2fdf3-jty5sqiiyd59d7kw.js","assets/a55ac3e4-mo9yl0d8rt6gwwxp.js","assets/5fe1e801-iaapkk0y92pqco4k.js","assets/97d4a2c4-k53nxdevhg5q7afz.js","assets/e3127a4c-msnjy7p3w5btr6rl.js","assets/09f5ffef-caxilcqwllci3pvs.js","assets/bbaf6cec-ot6uv9kcmfrb2je3.js","assets/1bc04b52-fstok3c507pom2j9.js","assets/1bc04b52-r2xqg1xowhrldwno.js","assets/30ca1328-pbl95wx6493wq92j.js","assets/e04c699b-ggwtg4re0nly33aa.js","assets/a7c981c9-c3x8l1hx7zhmdpnj.js","assets/cot-message-g4jkzz65.css","assets/757190b7-dp1id96su8v5mn03.js","assets/5983e573-cjcmpca7x0tkbsuj.js","assets/b67c2c3f-l1avyzva2lcx2nib.js","assets/363ee0e3-cz6m810itwnxvz6m.js"])))=>i.map(i=>d[i]);
var oa=Object.defineProperty,ra=Object.defineProperties;var ia=Object.getOwnPropertyDescriptors;var _t=Object.getOwnPropertySymbols;var la=Object.prototype.hasOwnProperty,ca=Object.prototype.propertyIsEnumerable;var wt=(s,e,t)=>e in s?oa(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ne=(s,e)=>{for(var t in e||(e={}))la.call(e,t)&&wt(s,t,e[t]);if(_t)for(var t of _t(e))ca.call(e,t)&&wt(s,t,e[t]);return s},Be=(s,e)=>ra(s,ia(e));import{b as Xe,r as A,j as o,d as _s,_ as B,c as Ge,M as ie,a as da,u as bt}from"./2340486e-n0khdanno9uzbccp.js";import{dm as Vt,dF as $t,dk as Ut,am as je,ds as ma,dq as es,e$ as ds,bp as D,ej as qe,bC as Fe,cB as fa,ao as ua,al as ze,dt as kt,R as Wt,e8 as He,e_ as ps,jb as cs,b as Ke,d as ga,J as Ht,l as ha,k6 as g,dW as ms,eH as pa,P as qt,gE as va,j as xa,y6 as ya,y7 as _a,eJ as St,eE as Tt,by as wa,aD as ba,cu as jt,kd as ka,g9 as Sa,eb as Ta,eg as ja,k4 as ye,aS as Ca,aT as Ia,fR as ls,nC as Aa,jM as Ea,eu as Ct,h as It,dI as At,y8 as La,e5 as Ma,cX as Pa,fQ as Na,dZ as Da}from"./4813494d-di0bpg5zidu9s57f.js";import{dx as Ra,d7 as vs,hn as V,a5 as Oa,l as Ba,A as Et,o as Fa,rm as za,ht as Va,ho as $a,hp as Ua,iq as Qt,fc as Wa,fd as Lt,rn as Ha,fe as Mt,ai as qa,bu as Zt,lw as Qa,bv as Jt,bd as Pt,ro as Za,rp as Ja,rq as Ka,S as Ya,fl as Xa,gv as Nt,eF as Kt,mY as Ga,mZ as en,qj as sn,ne as Dt,rr as tn,ng as an,rs as nn,rt as on,ny as rn,hh as ln,G as cn,ru as dn,rv as Rt,rw as mn,rx as fn,ry as un,rz as gn,rA as hn,rB as pn,rC as vn,n6 as xn,rD as yn,rE as _n,rF as wn,rG as bn,iA as kn,rH as Ot,rI as Sn,pk as Tn,rJ as jn,rK as Cn,rL as In,eC as An,fG as En}from"./1a7ebd5f-ihenykhpblfwilpu.js";import{r as ws,u as Yt}from"./b81d67c1-g85xaexv7seu9n1r.js";import{i as Ln,C as Mn}from"./929b8f98-bi5zibmx55zmngs7.js";import{D as Pn}from"./28938d3c-ne58pdayq54airr8.js";import{a as Nn}from"./db62250d-eyec17b70eqxu45z.js";import{g as Dn}from"./089c718c-clpuzb1fnoaty06o.js";const Bt=_s({manage:{id:"manage",defaultMessage:"Manage"},continue:{id:"continue",defaultMessage:"Continue"}});function Rn({title:s,description:e,settingsTab:t="general",clientThreadId:a,parentMessageId:n}){const l=Vt(a),d=Xe(),[r,f]=A.useState(!1),{openSettings:c}=Ra(),h=()=>{var _;if(r)return;f(!0);const u=ma(a),y=u?es.getCurrentNode(u):null;(y?(_=y.message.id)!=null?_:y.id:void 0)===n&&ws({conversation:l,promptMessage:ds("Yes, please proceed"),eventSource:"mouse",parentMessageId:n})},m=A.useCallback(()=>{const u=$t();Ut()&&u?u.openSettings(t):c()},[c,t]);return o.jsxs("div",{className:"max-w-md rounded-lg border p-4 shadow-sm",children:[o.jsx("h2",{className:"mb-1 font-bold",children:o.jsx(vs,{className:"text-base",children:s})}),o.jsx("p",{className:"mb-3 text-sm",children:o.jsx(vs,{className:"text-base",children:e})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(je,{className:"text-base",color:"secondary",onClick:m,children:d.formatMessage(Bt.manage)}),o.jsx(je,{className:"text-base",color:"primary",onClick:h,children:d.formatMessage(Bt.continue)})]})]})}const On=D(()=>B(()=>import("./da554a06-nplzj10vooi0vs4q.js"),__vite__mapDeps([0,1,2,3,4,5])).then(s=>s.OdysseyTakeoverNuxModal)),Bn=()=>{"use no forget";const s=Ba(Et.hasSeenOdysseyTakeoverModal),{clientThreadId:e}=V(),t=qe(e!=null?e:void 0,d=>es.findNode(d,r=>r.message.author.name==="n7jupd.metadata"));if(!e)return()=>{Fe.info("VNC modal opened without a client thread id")};const a=async d=>{const r=kt(d);if(r)return await Wt.safePost("/conversation/{conversation_id}/agent/resume",{parameters:{path:{conversation_id:r}}})},n=()=>{var r,f;if(!Ut()||!((r=t==null?void 0:t.message.metadata)!=null&&r.kaur1br5_mode))return Promise.resolve(!1);const d=kt(e);if(!d)return Fe.info("Agent viewer opened without a server thread id"),Promise.resolve(!1);try{const c=$t(),h=(f=c==null?void 0:c.tryOpenAgentViewer(d))!=null?f:!1;return Promise.resolve(h)}catch(c){return Fe.error("Failed to open local agent viewer - error thrown"),Promise.resolve(!1)}},l=async()=>{var r;if(await n()){Fe.info("Opened VNC modal with local agent viewer");return}V.setState({isResuming:!0}),V.setState({isOpen:!0}),ua.setSidebarOpen(!1);let d;ze.addAction("agent.conversation.resume_rpc_attempted",{client_thread_id:e});try{d=await a(e),d?ze.addAction("agent.conversation.resume_rpc_succeeded",{client_thread_id:e,vm_id:(r=d.vm_id)!=null?r:""}):ze.addAction("agent.conversation.resume_rpc_failed",{client_thread_id:e,reason:"no_response"})}catch(f){ze.addAction("agent.conversation.resume_rpc_failed",{client_thread_id:e,reason:"exception",error:f})}V.setState({isResuming:!1,vmId:d==null?void 0:d.vm_id}),zn({})};return async()=>{if(s.eligible){fa(On,{onConfirm:async()=>{Fa(Et.hasSeenOdysseyTakeoverModal),await l()}});return}await l()}},Fn=async(s,{startNewTurn:e})=>{V.setState({isOpen:!1}),await Vn(s,{startNewTurn:e})},zn=async({showPlaceholderMessage:s=!1})=>{var a;V.setState({isTakeoverInProgress:!0});const{clientThreadId:e}=V.getState();if(!e){Fe.info("VNC takeover started without a client thread id");return}s&&za(e);const t=await $n();V.setState({parentMessageId:(a=t==null?void 0:t.last_message_id)!=null?a:null})},Vn=async(s,{startNewTurn:e,skipTakeoverAfterAbort:t=void 0},a)=>{V.setState({isTakeoverInProgress:!1});const{clientThreadId:n}=V.getState();if(!n){Fe.info("VNC modal closed without a client thread id");return}if(!e)return;const l=Un(),{abortPromise:d}=V.getState();d&&t&&(await d,await t())||($a(n),await ws({conversation:Vt(n),eventSource:"mouse",promptMessage:Ua(s,a),parentMessageIdPromise:l,completionMetadata:{systemHints:[ps],conversationMode:{kind:He.PrimaryAssistant}}}))},$n=()=>{const{clientThreadId:s}=V.getState();if(!s)return Fe.info("stopAgent called without a client thread id"),Promise.resolve(void 0);const e=Va(s,void 0,{clientInitiated:!0,reason:"takeover",isLastTurnAgent:!0}).then(t=>t).finally(()=>{V.setState({abortPromise:null})});return V.setState({abortPromise:e}),e},Un=(s=5e3)=>new Promise(e=>{const{parentMessageId:t}=V.getState();if(t)return e(t);const a=setTimeout(()=>{n(),e(void 0)},s),n=V.subscribe(l=>{l.parentMessageId&&(e(l.parentMessageId),clearTimeout(a),n())})}),Wn=()=>{"use forget";const s=Ge.c(5),e=Bn();let t;s[0]!==e?(t=r=>({token:r.token,clientThreadId:r.clientThreadId,isOpen:r.isOpen,isTakeoverInProgress:r.isTakeoverInProgress,isResuming:r.isResuming,vmId:r.vmId,open:e,close:Fn}),s[0]=e,s[1]=t):t=s[1];const a=V(t),l=!Oa();let d;return s[2]!==l||s[3]!==a?(d=Be(ne({},a),{isVNCEnabled:l}),s[2]=l,s[3]=a,s[4]=d):d=s[4],d},Hn=s=>{"use forget";var j,P,$,se;const e=Ge.c(33),{currentGroupedMessage:t,isLastMessage:a,isLastTurnInConversation:n,conversation:l,turnIndex:d,lastAgentMetadataNode:r}=s,f=!!((j=r==null?void 0:r.metadata)!=null&&j.kaur1br5_mode);let c,h;e[0]!==(t==null?void 0:t.messages)||e[1]!==n?(c=cs(t==null?void 0:t.messages),h=n&&c&&Ln(c)&&!((P=c.metadata)!=null&&P.auto_proceed_cancelled)&&!(($=c.clientMetadata)!=null&&$.autoProceedCancelled),e[0]=t==null?void 0:t.messages,e[1]=n,e[2]=c,e[3]=h):(c=e[2],h=e[3]);const m=h;let u;e:{if(!((se=c==null?void 0:c.metadata)!=null&&se.open_tabs)){let L;e[4]===Symbol.for("react.memo_cache_sentinel")?(L=[],e[4]=L):L=e[4],u=L;break e}let W;e[5]!==c.metadata.open_tabs?(W=c.metadata.open_tabs.filter(Zn),e[5]=c.metadata.open_tabs,e[6]=W):W=e[6],u=W}let y;e[7]!==u?(y=u.filter(Jn),e[7]=u,e[8]=y):y=e[8];const p=y,_=p.length>0&&f;let x;e[9]!==l||e[10]!==c||e[11]!==p||e[12]!==_?(x=_&&(c==null?void 0:c.id)&&o.jsx(Xt,{openTabList:p,clientThreadId:l.id,messageId:c.id}),e[9]=l,e[10]=c,e[11]=p,e[12]=_,e[13]=x):x=e[13];let S;e[14]!==l||e[15]!==c||e[16]!==m||e[17]!==d?(S=m&&o.jsx(Mn,{clientThreadId:l.id,lastMessage:c,turnIndex:d}),e[14]=l,e[15]=c,e[16]=m,e[17]=d,e[18]=S):S=e[18];let b;e[19]!==a||e[20]!==n?(b=n&&a&&o.jsx(qa,{children:Kn}),e[19]=a,e[20]=n,e[21]=b):b=e[21];let k;e[22]!==l||e[23]!==t||e[24]!==f||e[25]!==a||e[26]!==n?(k=o.jsx(qn,{conversation:l,currentGroupedMessage:t,isLastMessage:a,isLastTurnInConversation:n,isKAUR1BR5:f}),e[22]=l,e[23]=t,e[24]=f,e[25]=a,e[26]=n,e[27]=k):k=e[27];let E;return e[28]!==x||e[29]!==S||e[30]!==b||e[31]!==k?(E=o.jsxs("div",{className:"my-2 flex flex-col",children:[x,S,b,k]}),e[28]=x,e[29]=S,e[30]=b,e[31]=k,e[32]=E):E=e[32],E};function Xt(s){"use forget";const e=Ge.c(30),{openTabList:t,clientThreadId:a,messageId:n}=s,[l,d]=A.useState(!1),{openThreadSidebar:r}=Qt(),f=Ke(ga),c=Wa(a);let h;e[0]!==t?(h=t.slice(0,3),e[0]=t,e[1]=h):h=e[1];const m=h,u=t.length>1&&t.length!==m.length;let y;e[2]!==f||e[3]!==n||e[4]!==t||e[5]!==r?(y=()=>{if(f){d(!0);return}r({type:"n7jupdTabs",messageId:n,tabs:t})},e[2]=f,e[3]=n,e[4]=t,e[5]=r,e[6]=y):y=e[6];const p=y;let _;e[7]===Symbol.for("react.memo_cache_sentinel")?(_=o.jsx("div",{className:"flex items-center py-0.5",children:o.jsx(ie,ne({},Lt.heading))}),e[7]=_):_=e[7];let x;e[8]!==p||e[9]!==t.length||e[10]!==u?(x=u&&o.jsxs(je,{onClick:p,color:"ghost",className:"text-token-text-secondary rounded-lg font-normal",contentWrapperClassName:"gap-1",children:[o.jsx(ie,{id:"BrbWdy",defaultMessage:"View {count} tabs",values:{count:t.length}}),o.jsx(Ha,{className:"icon-sm"})]}),e[8]=p,e[9]=t.length,e[10]=u,e[11]=x):x=e[11];let S;e[12]!==x?(S=o.jsxs("div",{className:"text-token-text-primary flex items-center justify-between px-3 py-2 text-sm font-medium",children:[_,x]}),e[12]=x,e[13]=S):S=e[13];let b;e[14]!==a||e[15]!==c||e[16]!==m?(b=o.jsx(Mt,{tabs:m,clientThreadId:a,className:"border-token-border-subtle flex flex-col border-t",isSafeMode:c}),e[14]=a,e[15]=c,e[16]=m,e[17]=b):b=e[17];let k;e[18]!==S||e[19]!==b?(k=o.jsxs("div",{className:"border-token-border-subtle bg-token-bg-secondary/30 text-token-text-primary w-full max-w-[360px] overflow-hidden rounded-2xl border",children:[S,b]}),e[18]=S,e[19]=b,e[20]=k):k=e[20];let E;e[21]!==a||e[22]!==f||e[23]!==l||e[24]!==c||e[25]!==t?(E=f&&o.jsx(Ht,{headerClassName:"ps-6! pe-5!",isOpen:l,showCloseButton:!0,onClose:()=>d(!1),testId:"modal-odyssey-open-tabs",title:o.jsx("div",{className:"flex w-full items-center text-[15px] font-medium",children:o.jsx(ie,ne({},Lt.heading))}),noPadding:!0,children:o.jsx(Mt,{tabs:t,clientThreadId:a,className:"border-token-border-subtle flex flex-col border-t",isSafeMode:c,detailed:!0})}),e[21]=a,e[22]=f,e[23]=l,e[24]=c,e[25]=t,e[26]=E):E=e[26];let j;return e[27]!==k||e[28]!==E?(j=o.jsxs(o.Fragment,{children:[k,E]}),e[27]=k,e[28]=E,e[29]=j):j=e[29],j}const qn=s=>{"use forget";var $;const e=Ge.c(16),{conversation:t,currentGroupedMessage:a,isLastMessage:n,isLastTurnInConversation:l,isKAUR1BR5:d}=s,{formatMessage:r}=Xe(),{open:f,isVNCEnabled:c}=Wn(),{selectedSources:h}=Zt(t.id),m=ha("733205176");let u;e:{if(!c){u=null;break e}if(!m){u=null;break e}if(!n||!l){u=null;break e}if(a.type!==g.Text){u=null;break e}u=a.messages[0]}const y=u;if(!y)return null;const p=($=y.metadata)==null?void 0:$.n7jupd_button_type;if(!p||p==="confirmation"||(p==="takeover"||p==="login")&&d)return null;let _;e[0]!==t||e[1]!==y.id||e[2]!==h?(_=async()=>{await ws({conversation:t,eventSource:"mouse",promptMessage:ds("Yes, please proceed",ne({system_hints:[ps]},h&&{selected_sources:Jt(h)})),parentMessageId:y.id,completionMetadata:{systemHints:[ps],conversationMode:{kind:He.PrimaryAssistant}}})},e[0]=t,e[1]=y.id,e[2]=h,e[3]=_):_=e[3];const x=_;let S;e[4]!==f||e[5]!==x?(S=se=>{switch(se){case"takeover":return f();case"login":return f();case"confirmation":return x()}},e[4]=f,e[5]=x,e[6]=S):S=e[6];const b=S;let k;e[7]!==b||e[8]!==p?(k=()=>b(p),e[7]=b,e[8]=p,e[9]=k):k=e[9];const E=Qn[p];let j;e[10]!==r||e[11]!==E?(j=r(E),e[10]=r,e[11]=E,e[12]=j):j=e[12];let P;return e[13]!==k||e[14]!==j?(P=o.jsx("div",{className:"my-2 flex",children:o.jsx(je,{onClick:k,children:j})}),e[13]=k,e[14]=j,e[15]=P):P=e[15],P},Qn=_s({takeover:{id:"odyssey-message-indicator.takeover",defaultMessage:"Take over"},login:{id:"odyssey-message-indicator.login",defaultMessage:"Log in"},confirmation:{id:"odyssey-message-indicator.confirm",defaultMessage:"Confirm"}});function Zn(s){return s.url==="about:blank"?!1:!(s.url==="https://openai.com/"&&!s.selected)}function Jn(s){var t;const e=(t=s.url)==null?void 0:t.trim().toLowerCase();return e&&e!=="about:blank"&&e!==""}function Kn(s){const{isScheduled:e,isScheduledRun:t}=s;return e&&!t&&o.jsx(Qa,{})}const Yn=s=>{"use forget";var _;const e=Ge.c(15),{conversation:t,turnIndex:a,isLastMessage:n,isLastTurnInConversation:l}=s;let d;e[0]!==a?(d=x=>a>0?es.getConversationTurnAtIndex(x,a-1):null,e[0]=a,e[1]=d):d=e[1];const r=qe(t.id,d);let f;e[2]!==(r==null?void 0:r.messages)?(f=r==null?void 0:r.messages.findLast(Xn),e[2]=r==null?void 0:r.messages,e[3]=f):f=e[3];const c=f;let h;e:{if(!((_=c==null?void 0:c.metadata)!=null&&_.open_tabs)){let S;e[4]===Symbol.for("react.memo_cache_sentinel")?(S=[],e[4]=S):S=e[4],h=S;break e}let x;e[5]!==c.metadata.open_tabs?(x=c.metadata.open_tabs.filter(Gn),e[5]=c.metadata.open_tabs,e[6]=x):x=e[6],h=x}let m;e[7]!==h?(m=h.filter(eo),e[7]=h,e[8]=m):m=e[8];const u=m;if(!n||!l||!c)return null;let y;e[9]!==t.id||e[10]!==c||e[11]!==u?(y=u.length>0&&(c==null?void 0:c.id)&&o.jsx(Xt,{openTabList:u,clientThreadId:t.id,messageId:c.id}),e[9]=t.id,e[10]=c,e[11]=u,e[12]=y):y=e[12];let p;return e[13]!==y?(p=o.jsx("div",{className:"my-2 flex flex-col",children:y}),e[13]=y,e[14]=p):p=e[14],p};function Xn(s){return s.author.role===ms.Tool&&s.author.name==="kaur1br5.dragonfruit"}function Gn(s){return s.url==="about:blank"?!1:!(s.url==="https://openai.com/"&&!s.selected)}function eo(s){var t;const e=(t=s.url)==null?void 0:t.trim().toLowerCase();return e&&e!=="about:blank"&&e!==""}function so(s,e,t){const a=e.elements.length;if(a===0)return;const n=Object.entries(s).reduce((l,[d,r])=>Array.isArray(r)?r.length>0?l+1:l:r!==""?l+1:l,0);qt.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",Be(ne({},va({clientThreadId:t})),{totalItems:a.toString(),completedItems:n.toString(),ratio:(n/a).toString()}))}function to(s,e){let t="";return e.elements.forEach(a=>{var f;const n=a.scope.split("/").pop(),l=n&&s[n],d=l?Array.isArray(l)?l.join(", "):l:"Any",r=(f=a.label)!=null?f:n;t+="".concat(r,": ").concat(d,"\n")}),t}function ao({messages:s,clientThreadId:e,isLastMessage:t}){var E;const a=s.find(j=>j.author.role===ms.Assistant),n=s.find(j=>{var P;return(P=j.metadata)==null?void 0:P.json_form}),l=(E=n==null?void 0:n.metadata)==null?void 0:E.json_form,[d,r]=A.useState({}),[f,c]=A.useState(),[h,m]=A.useState(),u=pa.useStore(),y=Yt(e);A.useEffect(()=>{l&&(c(l.json_form_ui),m(l.json_form_data))},[l]);const p=A.useCallback(()=>{if(r({}),f){const j=Be(ne({},f),{elements:f.elements.filter(P=>P.scope!=="#/properties/AdditionalInfo")});c(j)}h&&(delete h.properties.AdditionalInfo,m(h))},[r,c,m,f,h]),_=A.useCallback(()=>{if(f){const j=Be(ne({},f),{elements:[...f.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]});c(j)}if(h){const j=Be(ne({},h.properties),{AdditionalInfo:{type:"string"}});m(Be(ne({},h),{properties:j}))}},[c,m,f,h]),x=f==null?void 0:f.elements.some(j=>j.scope.endsWith("#/properties/AdditionalInfo")),S=qe(e,es.getCurrentLeafId),b=(n==null?void 0:n.id)!==S;if(!n||!h||!f)return(a==null?void 0:a.status)==="in_progress"&&t?o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsx(Pt,{className:"h-[26px] w-full"}),o.jsx(Pt,{className:"h-[26px] w-3/4"}),o.jsx(Za,{})]}):null;if(b)return null;const k=async j=>{const P=u.getActiveSystemHintType(),$=to(d,f);so(d,f,e),y({sourceEvent:j,promptMessage:ds($),completionMetadata:{systemHints:P?[P]:[],conversationMode:{kind:He.PrimaryAssistant}}})};return o.jsxs(Ja,{children:[o.jsx(no,{formData:d,dataSchema:h,uiSchema:f,setData:r,readOnly:b}),o.jsxs("div",{className:"flex w-full justify-between",children:[x?o.jsx("div",{}):o.jsx(je,{disabled:b,onClick:_,color:"secondary",className:"text-token-text-secondary",children:o.jsx(ie,{id:"Sen69P",defaultMessage:"Add a detail"})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(je,{disabled:b,onClick:p,color:"secondary",className:"text-token-text-secondary",children:o.jsx(ie,{id:"Uqo7UD",defaultMessage:"Reset"})}),o.jsx(je,{disabled:b,onClick:k,children:o.jsx(ie,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function no({dataSchema:s,uiSchema:e,setData:t,readOnly:a,formData:n}){return o.jsx("div",{children:o.jsx(Ka,{formData:n,readOnly:a,schema:s,uiSchema:e,onChange:l=>t(l)})})}var K=Uint8Array,We=Uint16Array,oo=Int32Array,Gt=new K([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ea=new K([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ro=new K([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sa=function(s,e){for(var t=new We(31),a=0;a<31;++a)t[a]=e+=1<<s[a-1];for(var n=new oo(t[30]),a=1;a<30;++a)for(var l=t[a];l<t[a+1];++l)n[l]=l-t[a]<<5|a;return{b:t,r:n}},ta=sa(Gt,2),aa=ta.b,io=ta.r;aa[28]=258,io[258]=28;var lo=sa(ea,0),co=lo.b,xs=new We(32768);for(var M=0;M<32768;++M){var Te=(M&43690)>>1|(M&21845)<<1;Te=(Te&52428)>>2|(Te&13107)<<2,Te=(Te&61680)>>4|(Te&3855)<<4,xs[M]=((Te&65280)>>8|(Te&255)<<8)>>1}var Ye=(function(s,e,t){for(var a=s.length,n=0,l=new We(e);n<a;++n)s[n]&&++l[s[n]-1];var d=new We(e);for(n=1;n<e;++n)d[n]=d[n-1]+l[n-1]<<1;var r;if(t){r=new We(1<<e);var f=15-e;for(n=0;n<a;++n)if(s[n])for(var c=n<<4|s[n],h=e-s[n],m=d[s[n]-1]++<<h,u=m|(1<<h)-1;m<=u;++m)r[xs[m]>>f]=c}else for(r=new We(a),n=0;n<a;++n)s[n]&&(r[n]=xs[d[s[n]-1]++]>>15-s[n]);return r}),ss=new K(288);for(var M=0;M<144;++M)ss[M]=8;for(var M=144;M<256;++M)ss[M]=9;for(var M=256;M<280;++M)ss[M]=7;for(var M=280;M<288;++M)ss[M]=8;var na=new K(32);for(var M=0;M<32;++M)na[M]=5;var mo=Ye(ss,9,1),fo=Ye(na,5,1),us=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},oe=function(s,e,t){var a=e/8|0;return(s[a]|s[a+1]<<8)>>(e&7)&t},gs=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},uo=function(s){return(s+7)/8|0},bs=function(s,e,t){return(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length),new K(s.subarray(e,t))},go=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ee=function(s,e,t){var a=new Error(e||go[s]);if(a.code=s,Error.captureStackTrace&&Error.captureStackTrace(a,ee),!t)throw a;return a},ho=function(s,e,t,a){var n=s.length,l=a?a.length:0;if(!n||e.f&&!e.l)return t||new K(0);var d=!t,r=d||e.i!=2,f=e.i;d&&(t=new K(n*3));var c=function(Ne){var me=t.length;if(Ne>me){var C=new K(Math.max(me*2,Ne));C.set(t),t=C}},h=e.f||0,m=e.p||0,u=e.b||0,y=e.l,p=e.d,_=e.m,x=e.n,S=n*8;do{if(!y){h=oe(s,m,1);var b=oe(s,m+1,3);if(m+=3,b)if(b==1)y=mo,p=fo,_=9,x=5;else if(b==2){var P=oe(s,m,31)+257,$=oe(s,m+10,15)+4,se=P+oe(s,m+5,31)+1;m+=14;for(var W=new K(se),L=new K(19),N=0;N<$;++N)L[ro[N]]=oe(s,m+N*3,7);m+=$*3;for(var Ce=us(L),Ie=(1<<Ce)-1,he=Ye(L,Ce,1),N=0;N<se;){var Ae=he[oe(s,m,Ie)];m+=Ae&15;var k=Ae>>4;if(k<16)W[N++]=k;else{var Y=0,le=0;for(k==16?(le=3+oe(s,m,3),m+=2,Y=W[N-1]):k==17?(le=3+oe(s,m,7),m+=3):k==18&&(le=11+oe(s,m,127),m+=7);le--;)W[N++]=Y}}var _e=W.subarray(0,P),te=W.subarray(P);_=us(_e),x=us(te),y=Ye(_e,_,1),p=Ye(te,x,1)}else ee(1);else{var k=uo(m)+4,E=s[k-4]|s[k-3]<<8,j=k+E;if(j>n){f&&ee(0);break}r&&c(u+E),t.set(s.subarray(k,j),u),e.b=u+=E,e.p=m=j*8,e.f=h;continue}if(m>S){f&&ee(0);break}}r&&c(u+131072);for(var Ve=(1<<_)-1,Qe=(1<<x)-1,we=m;;we=m){var Y=y[gs(s,m)&Ve],X=Y>>4;if(m+=Y&15,m>S){f&&ee(0);break}if(Y||ee(2),X<256)t[u++]=X;else if(X==256){we=m,y=null;break}else{var Ee=X-254;if(X>264){var N=X-257,ce=Gt[N];Ee=oe(s,m,(1<<ce)-1)+aa[N],m+=ce}var de=p[gs(s,m)&Qe],pe=de>>4;de||ee(3),m+=de&15;var te=co[pe];if(pe>3){var ce=ea[pe];te+=gs(s,m)&(1<<ce)-1,m+=ce}if(m>S){f&&ee(0);break}r&&c(u+131072);var Le=u+Ee;if(u<te){var Me=l-te,Pe=Math.min(te,Le);for(Me+u<0&&ee(3);u<Pe;++u)t[u]=a[Me+u]}for(;u<Le;++u)t[u]=t[u-te]}}e.l=y,e.p=we,e.b=u,e.f=h,y&&(h=1,e.m=_,e.d=p,e.n=x)}while(!h);return u!=t.length&&d?bs(t,0,u):t.subarray(0,u)},po=new K(0),ge=function(s,e){return s[e]|s[e+1]<<8},re=function(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24)>>>0},hs=function(s,e){return re(s,e)+re(s,e+4)*4294967296};function vo(s,e){return ho(s,{i:2},e&&e.out,e&&e.dictionary)}var ys=typeof TextDecoder<"u"&&new TextDecoder,xo=0;try{ys.decode(po,{stream:!0}),xo=1}catch(s){}var yo=function(s){for(var e="",t=0;;){var a=s[t++],n=(a>127)+(a>223)+(a>239);if(t+n>s.length)return{s:e,r:bs(s,t-1)};n?n==3?(a=((a&15)<<18|(s[t++]&63)<<12|(s[t++]&63)<<6|s[t++]&63)-65536,e+=String.fromCharCode(55296|a>>10,56320|a&1023)):n&1?e+=String.fromCharCode((a&31)<<6|s[t++]&63):e+=String.fromCharCode((a&15)<<12|(s[t++]&63)<<6|s[t++]&63):e+=String.fromCharCode(a)}};function _o(s,e){if(e){for(var t="",a=0;a<s.length;a+=16384)t+=String.fromCharCode.apply(null,s.subarray(a,a+16384));return t}else{if(ys)return ys.decode(s);var n=yo(s),l=n.s,t=n.r;return t.length&&ee(8),l}}var wo=function(s,e){return e+30+ge(s,e+26)+ge(s,e+28)},bo=function(s,e,t){var a=ge(s,e+28),n=_o(s.subarray(e+46,e+46+a),!(ge(s,e+8)&2048)),l=e+46+a,d=re(s,e+20),r=t&&d==4294967295?ko(s,l):[d,re(s,e+24),re(s,e+42)],f=r[0],c=r[1],h=r[2];return[ge(s,e+10),f,c,n,l+ge(s,e+30)+ge(s,e+32),h]},ko=function(s,e){for(;ge(s,e)!=1;e+=4+ge(s,e+2));return[hs(s,e+12),hs(s,e+4),hs(s,e+20)]};function Ft(s,e){for(var t={},a=s.length-22;re(s,a)!=101010256;--a)(!a||s.length-a>65558)&&ee(13);var n=ge(s,a+8);if(!n)return{};var l=re(s,a+16),d=l==4294967295||n==65535;if(d){var r=re(s,a-12);d=re(s,r)==101075792,d&&(n=re(s,r+32),l=re(s,r+48))}for(var f=0;f<n;++f){var c=bo(s,l,d),h=c[0],m=c[1],u=c[2],y=c[3],p=c[4],_=c[5],x=wo(s,_);l=p,h?h==8?t[y]=vo(s.subarray(x,x+m),{out:new K(u)}):ee(14,"unknown compression type "+h):t[y]=bs(s,x,x+m)}return t}const is=_s({fallbackTitle:{id:"dG/v4e",defaultMessage:"Skill preview"},fallbackDescription:{id:"UZIKtv",defaultMessage:"Open to preview the skill details."},addToLibraryFailed:{id:"9hhBaS",defaultMessage:"Failed to add the skill to your library. Please try again."}}),So=s=>{const t=s.replace(/^\ufeff/,"").match(/^---\s*\r?\n([\s\S]*?)\r?\n---/);if(!t)return{};const a={},n=t[1].split(/\r?\n/),l=r=>/^[A-Za-z0-9_-]+:/.test(r)&&!/^\s/.test(r),d=r=>r.trim().replace(/^["']|["']$/g,"");for(let r=0;r<n.length;r++){const f=n[r];if(!f.trim()||f.trim().startsWith("#")||!l(f))continue;const c=f.indexOf(":");if(c===-1)continue;const h=f.slice(0,c).trim(),m=f.slice(c+1).trim();if(h==="name"){a.name=d(m);continue}if(h==="description"){if(!(m==="|"||m===">"||m.startsWith("|-")||m.startsWith("|+")||m.startsWith(">-")||m.startsWith(">+"))){a.description=d(m);continue}const y=[];let p=r+1,_=null;for(;p<n.length;){const x=n[p];if(l(x)&&!x.trim().startsWith("#"))break;if(x.trim().length===0){y.push(""),p++;continue}if(_==null){const b=x.match(/^[ \t]+/);_=b?b[0].length:0}const S=_>0?x.slice(_):x;y.push(S),p++}a.description=y.join("\n").trimEnd(),r=p-1}}return a},To=s=>{const t=s.replace(/^---\s*[\s\S]*?\r?\n---\s*/m,"").split(/\r?\n/);for(const a of t){const n=a.trim();if(n.startsWith("#"))return n.replace(/^#+\s*/,"").trim()}return""},jo=s=>{const e=s.split(/\n\s*\n/).map(t=>t.trim()).filter(Boolean);for(const t of e)if(!t.startsWith("#"))return t.replace(/^#+\s*/,"").trim();return""},zt=({messageId:s,path:e,rawContent:t,fallbackTitle:a,fallbackDescription:n})=>{var p,_,x,S,b,k;const l=So(t),d=Kt(t),r=(p=l.name)==null?void 0:p.trim(),f=(_=l.description)==null?void 0:_.trim(),c=To(t),h=jo(d),m=(S=(x=r&&r.length>0?r:void 0)!=null?x:c.length>0?c:void 0)!=null?S:a,u=(k=(b=f&&f.length>0?f:void 0)!=null?b:h.length>0?h:void 0)!=null?k:n,y={start:0,length:new TextEncoder().encode(t).length};return{id:s,name:m,description:u,files:{[e]:y},previewContents:{[e]:t},isReadOnly:!0}},Co=({conversation:s,message:e})=>{var X,Ee,ce,de,pe,Le,Me,Pe,Ne,me;const t=Xe(),a=xa(),n=da(),l=A.useContext(Ya),{data:d}=Xa({scope:"personal"}),r=Ke(()=>s.serverId$()),f=(X=l==null?void 0:l.serverSharedThreadId)!=null?X:r,c=!!(l!=null&&l.serverSharedThreadId),h=!!f,m=t.formatMessage(is.fallbackTitle),u=t.formatMessage(is.fallbackDescription),y=ya(e),p=_a(y),[_,x]=A.useState({status:p?"loading":"idle"}),[S,b]=A.useState(null),k=A.useCallback(async C=>{var ke,fe,Ze,Je,ts;if(!p||!f)throw new Error("Missing skill zip path or server thread id");const G=(await Nt(e.id,f,p,c)).download_url;if(!G)throw new Error("Missing sandbox download URL for skill zip");const q=await St.get(G,{additionalHeaders:Tt(),skipJsonTransform:!0,credentials:"omit"});if(!(q instanceof Response)||!q.ok)throw new Error("Zip download failed with ".concat(q instanceof Response?q.status:"unknown"));const be=await q.arrayBuffer(),Q=Ft(new Uint8Array(be)),R=Object.entries(Q).filter(([Se])=>!Se.endsWith("/")),Z=R.find(([Se])=>Se.toLowerCase().endsWith("skill.md"));if(!Z)throw new Error("SKILL.md not found in skill zip");const ae=R.filter(([Se])=>!Se.toLowerCase().endsWith("skill.md")),[ve,i]=Z,v=new TextDecoder("utf-8").decode(i),F=zt({messageId:e.id,path:ve,rawContent:v,fallbackTitle:m,fallbackDescription:u}),I=(ke=F.name)!=null?ke:m,xe=(fe=F.description)!=null?fe:u,$e=Kt(v),z=[];if(ae.length>0){const as=(Ze=(await Ga(ae.map(([J])=>{var De;return{filename:(De=J.split("/").pop())!=null?De:J,content_type:"application/octet-stream"}}))).uploads)!=null?Ze:[];if(as.length!==ae.length)throw new Error("Failed to initialize draft uploads for all files");for(const[J,[De,ns]]of ae.entries()){const Re=as[J];if(!Re)throw new Error("Missing draft upload info");const os=Uint8Array.from(ns),rs=new Blob([os],{type:"application/octet-stream"});await en.put(Re.upload_url,rs,{headers:{"Content-Type":"application/octet-stream","x-ms-blob-type":"BlockBlob","x-ms-version":"2020-04-08"}}),await Wt.safePost("/hazelnuts/uploads/finish",{requestBody:{file_id:Re.file_id}}),z.push({file_id:Re.file_id,path:De})}}const fs=await sn({id:C,name:I,description:xe,instructions:$e,files:z,file_contents:[]},n);return await n.invalidateQueries({queryKey:["hazelnuts"]}),(ts=(Je=fs.hazelnuts)==null?void 0:Je[0])!=null?ts:null},[u,m,c,e.id,n,f,p]);A.useEffect(()=>{if(!p){x({status:"error"});return}if(!f)return;let C=!0;const H=new AbortController;x({status:"loading"});const G=(Q,R)=>new Promise((Z,ae)=>{const ve=setTimeout(Z,Q),i=()=>{clearTimeout(ve),ae(Object.assign(new Error("Aborted"),{name:"AbortError"}))};if(R.aborted)return i();R.addEventListener("abort",i,{once:!0})}),q=async()=>{const R=(await Nt(e.id,f,p,c)).download_url;if(!R)throw new Error("Missing sandbox download URL for skill zip");const Z=await St.get(R,{additionalHeaders:Tt(),signal:H.signal,skipJsonTransform:!0,credentials:"omit"});if(!(Z instanceof Response)||!Z.ok)throw new Error("Zip download failed with ".concat(Z instanceof Response?Z.status:"unknown"));const ae=await Z.arrayBuffer(),ve=Ft(new Uint8Array(ae)),i=Object.keys(ve).find(F=>F.toLowerCase().endsWith("skill.md"));if(!i)throw new Error("SKILL.md not found in skill zip");const v=new TextDecoder("utf-8").decode(ve[i]);return zt({messageId:e.id,path:i,rawContent:v,fallbackTitle:m,fallbackDescription:u})};return(async()=>{for(let Q=1;Q<=2;Q++)try{const R=await q();if(!C)return;x({status:"ready",skill:R});return}catch(R){if(!C||R instanceof Error&&R.name==="AbortError")return;if(Q===1){try{await G(1e3,H.signal)}catch(Z){return}continue}R instanceof Error&&ze.addError(R,{message_id:e.id,sandbox_path:p,attempt:Q}),x({status:"error"})}})(),()=>{C=!1,H.abort()}},[u,m,c,e.id,f,p]);const{mutateAsync:E,isPending:j}=bt({mutationFn:()=>k(null),onSuccess:C=>{C!=null&&C.id&&b(C)},onError:C=>{a.danger(Dt({error:C,intl:t,fallbackMessage:is.addToLibraryFailed})),ze.addError(C)}}),{mutateAsync:P,isPending:$}=bt({mutationFn:C=>k(C),onSuccess:C=>{C!=null&&C.id&&b(C)},onError:C=>{a.danger(Dt({error:C,intl:t,fallbackMessage:is.addToLibraryFailed})),ze.addError(C)}}),se=A.useCallback(()=>{_.skill&&tn(_.skill,()=>{})},[_.skill]),W=(de=(ce=(Ee=_.skill)==null?void 0:Ee.name)==null?void 0:ce.trim())==null?void 0:de.toLowerCase(),L=W&&(d!=null&&d.hazelnuts)?d.hazelnuts.find(C=>{var H,G;return((G=(H=C.name)==null?void 0:H.trim())==null?void 0:G.toLowerCase())===W}):void 0,N=S!=null?S:L,Ce=A.useCallback(()=>{E()},[E]),Ie=A.useCallback(()=>{var q,be,Q;if(!(N!=null&&N.id))return;const C=(Q=(be=N.name)!=null?be:(q=_.skill)==null?void 0:q.name)!=null?Q:"this",H=an(N.id,C),G="/?".concat(H.toString(),"&disable_auto_send=1");window.open(G,"_blank","noopener,noreferrer")},[N,(pe=_.skill)==null?void 0:pe.name]),he=A.useCallback(()=>{L!=null&&L.id&&P(L.id)},[L==null?void 0:L.id,P]),Ae=(Me=(Le=_.skill)==null?void 0:Le.name)!=null?Me:m,Y=(Ne=(Pe=_.skill)==null?void 0:Pe.description)!=null?Ne:u,le=_.status==="loading",_e=_.status==="error",te=le||_e||!_.skill||!h,Ve=le||_e||!_.skill||!h||j||$,Qe=!!(N!=null&&N.id),we=!!((me=L==null?void 0:L.permissions)!=null&&me.can_write);return o.jsx(nn,{title:Ae,description:Y,isLoading:le,isError:_e,isExpandDisabled:te,isAddDisabled:Ve,isInLibrary:Qe,isAdding:j,canReplace:we,isReplacing:$,onAddToLibrary:Ce,onTryInChat:Ie,onReplaceSkill:he,onExpand:se})};function Io(s,e,t){const a=Xe(),{selectedSources:n}=Zt(s),l=Yt(s);return A.useCallback(async()=>await l({promptMessage:ds(a.formatMessage({id:"3qSZZF",defaultMessage:"I understand the risks. Please continue"}),ne({user_acknowledges_pim:!0,system_hints:e},n&&{selected_sources:Jt(n)})),completionMetadata:{systemHints:e,conversationMode:t},eventSource:"mouse"}),[l,t,e,a,n])}const Ao=({onMarkSafe:s,justification:e,clientThreadId:t,flaggedMessageId:a})=>{const[n,l]=A.useState(!1),d=Xe(),r=A.useCallback(()=>l(!1),[]);return o.jsxs(o.Fragment,{children:[o.jsx(Ht,{testId:"modal-confirm-close-editor",isOpen:n,size:"custom",className:"max-w-xl",onClose:r,type:"warning",hideSeparator:!1,title:o.jsx("span",{className:"text-xl",children:o.jsx(ie,{id:"lzy3Zg",defaultMessage:"Potentially Malicious Content Detected"})}),primaryButton:o.jsx(jt.Button,{title:d.formatMessage({id:"E82qxN",defaultMessage:"Mark safe and continue"}),color:"danger",onClick:s}),secondaryButton:o.jsx(jt.Button,{title:d.formatMessage({id:"byfawg",defaultMessage:"Don't mark safe"}),color:"secondary",onClick:r}),showCloseButton:!0,closeButton:o.jsx(ba,{onClick:r}),children:o.jsxs("div",{children:[o.jsx("div",{className:"text-md text-token-text-secondary pb-2",children:e?o.jsx(vs,{children:e}):o.jsx(ie,{id:"OkPb2T",defaultMessage:"This webpage contained hidden instructions that may be attempting to extract sensitive information. You should only continue if you're sure this content is safe."})}),!!a&&o.jsx(on,{clientThreadId:t,messageId:a,renderClosestScreenshot:!0})]})}),o.jsx(je,{color:"danger",onClick:()=>l(!0),children:o.jsx(ie,{id:"5L93Tx",defaultMessage:"Continue"})})]})};function Eo({children:s,isFinalTurn:e,hasActiveRequest:t,conversationMode:a,clientThreadId:n,justification:l,flaggedMessageId:d}){const r=qe(n,h=>{var m;return(m=es.findNode(h,u=>u.message.author.role===ms.User))==null?void 0:m.message}),f=A.useMemo(()=>{var h;return(h=r==null?void 0:r.metadata)==null?void 0:h.system_hints},[r]),c=Io(n,f,a);return o.jsxs("div",{children:[o.jsxs("div",{className:"bg-token-main-surface-secondary mt-1 flex gap-2 rounded-2xl px-3 py-2",children:[o.jsx(wa,{className:"icon-xl mt-2"}),o.jsx("div",{children:s})]}),e&&!t&&o.jsx("div",{className:"mt-2",children:o.jsx(Lo,{onMarkSafe:c,justification:l,flaggedMessageId:d,clientThreadId:n})})]})}function Lo({onMarkSafe:s,justification:e,clientThreadId:t,flaggedMessageId:a}){return o.jsx("div",{children:o.jsx(Ao,{onMarkSafe:s,justification:e,clientThreadId:t,flaggedMessageId:a})})}const Mo=D(()=>B(()=>import("./1676515f-c99or8zu6nxqpyff.js"),__vite__mapDeps([6,1,4,2,3,5]))),Po=D(()=>B(()=>import("./fa685806-a2zoho20zrc3hsnw.js"),__vite__mapDeps([7,1,2,3,8]))),No=D(()=>B(()=>import("./f85a3e0b-gtbeej2oreusa2q4.js"),__vite__mapDeps([9,1,2,3,10,4,5,11,12,13,14]))),Do=D(()=>B(()=>import("./019abe50-bh3hd4ysottp48ja.js"),__vite__mapDeps([15,1,2,3,16,17,4,5,18,14,12,13,19,20]))),Ro=D(async()=>()=>null),Oo=D(async()=>(await B(()=>import("./e0921b7a-d80kbpu52j6pqerp.js"),__vite__mapDeps([21,1,2,3,4,5]))).GlauxMessage),Bo=D(async()=>(await B(()=>import("./c1811d6e-9vuh4tyfttidvn72.js"),__vite__mapDeps([22,1,2,3,4,5,18,23,24,25,19,20,26,27,28,12,13,29,30,10,11,14]))).ImageGenMessage),Fo=D(()=>B(()=>import("./3c297c26-ggni0grvxxta5v5c.js"),__vite__mapDeps([31,1,2,3,4,5]))),zo=D(()=>B(()=>import("./1a7ebd5f-ihenykhpblfwilpu.js").then(s=>s.G0),__vite__mapDeps([4,1,2,3,5])).then(s=>s.BrowsingMessage)),Vo=D(()=>B(()=>import("./6639ec14-ekyw7koprp1owxh0.js"),__vite__mapDeps([32,1,2,3,4,5,12,13,11,14,33])).then(s=>s.BrowserToolMessage)),$o=D(()=>B(()=>import("./4f2e40fd-cu0afmb5yw4063az.js"),__vite__mapDeps([34,1,2,3,4,5])).then(s=>s.SearchResultMessage)),Uo=D(()=>B(()=>import("./495cf45b-b9cc09citdppd763.js"),__vite__mapDeps([35,1,2,3,4,5,36,37,38,39,40,41,42,43,44,16,17,45,46,47,30,12,13])).then(s=>s.JITPluginMessage)),Wo=D(()=>B(()=>import("./2b82192b-k8orr4u13qyx78ry.js"),__vite__mapDeps([48,1,2,3,38,4,5])).then(s=>s.APIToolElicitationMessage)),Ho=D(()=>B(()=>import("./dcbc66ee-b9m14nqh30npsem2.js"),__vite__mapDeps([49,1,2,3,50,51,4,5])).then(s=>s.DataAnalysisMessage)),qo=D(()=>B(()=>import("./78321319-nf4yeb2chcf12xq9.js"),__vite__mapDeps([52,1,2,3,4,5,53,26,27,20,28,54,55,21,56,57,51,58,59,60,61,62,63,25,19,64,65,12,13,29,30,10,11,14,66]))),Qo=D(()=>B(()=>import("./757190b7-dp1id96su8v5mn03.js"),__vite__mapDeps([67,1,2,3,53,4,5,26,27,20,28,54,55,21,56,57,51,58,59,60,61,62,63,25,19,64,65,12,13,29,30,10,11,14,66])).then(s=>s.LegacyCoTMessage)),Zo=D(()=>B(()=>import("./ab492d51-juf3hjupp03irvcd.js"),__vite__mapDeps([53,1,2,3,4,5,26,27,20,28,54,55,21,56,57,51,58,59,60,61,62,63,25,19,64,65,12,13,29,30,10,11,14,66])).then(s=>s.CoT)),Jo=D(()=>B(()=>import("./5983e573-cjcmpca7x0tkbsuj.js"),__vite__mapDeps([68,1,2,3,4,5,69])).then(s=>s.JawboneMessage)),Ko=D(async()=>()=>null),Yo=D(()=>B(()=>import("./363ee0e3-cz6m810itwnxvz6m.js"),__vite__mapDeps([70,1,2,3,4,5])).then(s=>s.HazelnutEnablePrompt));function Xo(s){if(s.some(e=>e.type===g.SearchGPTQuery)){const t=s.filter(n=>n.type===ye).flatMap(n=>n.groups),a=t.flatMap(n=>n.messages.map(l=>{var d;return(d=l.metadata)==null?void 0:d.search_turns_count})).findLast(n=>n!=null);return a!=null?a>1:(function(){const l=t.filter(f=>f.type===g.StructuredThoughts),d=t.filter(f=>f.type===g.CoTSearchTool),r=(()=>{function f(h){return h.type===g.StructuredThoughts&&h.messages.flatMap(m=>m.content).some(m=>m.content_type===Da.StructuredThoughts&&m.thoughts.length>0)}let c=!1;for(const h of t)if(h.type===g.CoTSearchTool)c=!0;else if(f(h)&&c)return!0;return!1})();return l.length>1||d.length>1||r})()}return!0}function Go(s,e){var t;if(s.type===ye){const a=cs(s.groups);return((t=a==null?void 0:a.messages[0].metadata)==null?void 0:t.is_visually_hidden_reasoning_group)&&e===0}return!1}function er(s){return s.type===ye?!1:s.messages.some(e=>In(e))}function ur({groupedMessagesToRender:s,allMessages:e,allGroupedMessages:t,conversation:a,isUserTurn:n,isCompletionRequestInProgress:l,isFeedbackEnabled:d,isFinalTurn:r,isFinalUserTurn:f,isFinalAssistantTurn:c,isGlauxTurn:h=!1,isPersonalContextTurn:m=!1,hasActiveRequest:u,onRequestCompletion:y,turnIndex:p,shouldGrowContainer:_=!0,isParagen:x=!1,renderingView:S="chat",isAgentTurn:b=!1,isAsyncCorrectionTurn:k=!1,isKAUR1BR5:E=!1,wasInterrupted:j=!1,superWidgetContent:P=null,lastAgentMetadataNode:$,isWithinFirstAssistantTurns:se=!1,hasSearchSystemHint:W=!1,isSteeringEnabledTurn:L=!1,isSteeringTurnInProgress:N=!1,turnExchangeId:Ce=void 0}){var ae,ve;const{showDebugConversationTurns:Ie}=ka(),[he]=qe(a.id,i=>[i==null?void 0:i.mode]),Ae=Ke(()=>Sa(a)),Y=Ke(()=>Ta(a)),le=rn(),_e=Ke(()=>ja());let Ve=t.some(i=>i.type===ye&&i.groups.some(v=>v.type===g.RetrievalBrowsing))||t.some(i=>i.type===g.Browsing||i.type===g.RetrievalBrowsing||i.type===g.SearchGPTQuery||i.type===g.n7jupd||i.type===g.q7dr546);const Qe=t.some(i=>i.type===g.SearchGPTQuery),we=!n&&W&&l&&u&&!Qe&&_e,X=A.useRef(!1);we&&(X.current=!0,Ve=!0);const Ee=qe(a.id,i=>{var v;for(let F=e.length-1;F>=0;F--){const I=e[F],xe=(v=i==null?void 0:i.tree.getNodeIfExists(I.id))==null?void 0:v.message,$e=xe?En(xe):void 0;if($e)return Object.assign({conversation:a,messageId:e[F].id},$e)}}),ce=ln(()=>Ca.count(Ia.DEFAULT,"conversation_turn_grouped_messages.attempted_render_missing_type_f959b8c")),de=cs(e),pe=cn({clientThreadId:a.id,conversationMode:he}),Le=A.useCallback(({sourceEvent:i,requestedModelId:v,appendMessages:F,extraStreamParams:I,isReasoningSkipped:xe})=>{de&&pe({sourceEvent:i,nodeId:de.id,requestedModelId:v,appendMessages:F,extraStreamParams:I,isReasoningSkipped:xe})},[de,pe]),{closeThreadSidebar:Me}=Qt(),Pe=ls(s,i=>i.type!==g.Debug),Ne=Ie?t.length-1:Pe,me=s.map((i,v)=>{var De,ns,Re,os,rs,ks,Ss,Ts,js,Cs,Is,As,Es,Ls,Ms,Ps,Ns,Ds,Rs,Os,Bs,Fs,zs,Vs,$s,Us,Ws,Hs,qs,Qs,Zs,Js,Ks,Ys,Xs,Gs,et,st,tt,at,nt,ot,rt,it,lt,ct,dt,mt,ft,ut,gt,ht,pt,vt,xt,yt;const F=u||er(i),I=b?v===Pe:v===Ne,xe=Xo(s),$e=Go(i,v),z=v===t.length-1?void 0:t[v+1],fs=(z==null?void 0:z.type)===ye?z.groups.at(-1):z,ke=v===0?void 0:s[v-1],fe=(ke==null?void 0:ke.type)!==ye?ke:void 0,Ze=fe==null?void 0:fe.type,Je=fe==null?void 0:fe.messages,ts=e==null?void 0:e.filter(w=>{var T,O;return((T=w.metadata)==null?void 0:T.python_citation)||((O=w.metadata)==null?void 0:O.container_citation)});if(i.type===ye){const w=i.groups[0].messages[0],T=i.groups.some(U=>U.messages.some(Oe=>{var Ue;return(Ue=Oe.metadata)==null?void 0:Ue.classifier_response}));if(!xe||$e)return null;const O=ls(s,U=>U.type===ye||!U.messages.some(Oe=>Aa(Oe.id))),ue=r&&(I||O===v);return L&&!ue?null:o.jsx(Zo,{isStreaming:ue&&l,latestError:Ee,isFinalAssistantTurn:c,messageGroups:i.groups,nextMessageGroup:fs,prevMessageGroup:fe,isAutoswitchOptOutEnabled:T,handleSkipClick:U=>{Me(),qt.logEventWithStatsig("chatgpt_web_autoswitch_reasoning_skip_clicked","chatgpt_web_autoswitch_reasoning_skip_clicked",{conversationId:a.id,messageId:i.groups[0].messages[0].id}),Ae&&Le({sourceEvent:U,requestedModelId:Ae.id,isReasoningSkipped:!0,isAgentTurn:b})},isAgentTurn:b,isAsyncCorrectionTurn:k,isGlauxTurn:h,isPersonalContextTurn:m,isKAUR1BR5:E,wasInterrupted:j,lastAgentMetadataNode:$,conversation:a,turnIndex:p,currentGroupedMessageIndex:v,isSteeringEnabledTurn:L,turnExchangeId:Ce},"cot-"+w.id)}const Se=i&&!Ea(i.messages[0]),as=Ve&&Se,J=[];if(as||J.push(o.jsx(Nn,{className:"min-h-8",message:i.messages[0],isFeedbackEnabled:d,isFinalUserTurn:f,isWithinFirstAssistantTurns:se,isCompletionInProgress:I&&l,hasActiveRequest:u,turnIndex:p,conversation:a,isUserTurn:n,prevGroupedMessageType:Ze,prevGroupedMessages:Je,citableMessages:ts,superWidgetContent:P,isSteeringEnabledTurn:L,isFinalTurn:r},"text-message-"+i.messages[0].id)),Ie&&J.push(o.jsx(Ko,{clientThreadId:a.id,message:i.messages[0]},"message-debug-"+i.messages[0].id)),i.type===g.Text&&((De=i.messages[0].metadata)!=null&&De[Ct])){const w=i.messages[0].metadata[Ct],T=(ns=w.sources)!=null?ns:[];return o.jsxs(A.Fragment,{children:[T.map((O,ue)=>o.jsx(dn,{browserContextMetadata:w,sourceIndex:ue,className:It(Dn(!0),"mb-1","block","[.text-message+&]:mt-5")},"browser-context-".concat(i.messages[0].id,"-").concat(ue))),J]},"group-"+i.messages[0].id)}if(we&&I)return o.jsx(Rt,{clientThreadId:a.id,turnIndex:p,isRequestActive:u,isLastMessage:I,isLastTurnInConversation:r,searchModelQueries:[],showFastNav:!1,shouldShowAnimatedBlackDot:!1},"searchquery-forced-".concat(a.id,"-").concat(p));switch(i.type){case g.Text:case g.MultiText:if(i.type===g.Text){const w=(Re=i.messages[0])==null?void 0:Re.metadata,T=typeof(w==null?void 0:w.source)=="string"&&(w==null?void 0:w.source)==="dream_followup";return o.jsxs(A.Fragment,{children:[T&&ke&&o.jsxs("div",{className:"mx-auto mt-8 mb-6 flex w-full items-center justify-center",children:[o.jsx("div",{className:"h-px flex-1 bg-gray-200 dark:bg-gray-700","aria-hidden":"true"}),o.jsx("p",{className:"mx-3 shrink text-[14px] whitespace-nowrap text-gray-500",children:o.jsx(ie,{id:"threadLayout.proactiveAssistantFollowupDivider",defaultMessage:"Follow-up question"})}),o.jsx("div",{className:"h-px flex-1 bg-gray-200 dark:bg-gray-700","aria-hidden":"true"})]},"proactive-divider-"+i.messages[0].id),J,b&&o.jsx(Hn,{conversation:a,currentGroupedMessage:i,isLastMessage:I,isLastTurnInConversation:r,turnIndex:p,lastAgentMetadataNode:$}),o.jsx(Yn,{turnIndex:p,conversation:a,isLastMessage:I,isLastTurnInConversation:r}),o.jsx(_n,{isUserTurn:n,message:i.messages[0]}),o.jsx(wn,{isUserTurn:n,message:i.messages[0],clientThreadId:a.id})]},"group-"+i.messages[0].id)}else return i.type===g.MultiText?o.jsx(No,{conversation:a,messages:i.messages,isCompletionInProgress:I&&l,isFeedbackEnabled:d,hasActiveRequest:u,prevGroupedMessageType:Ze,prevGroupedMessages:Je},"multitext-"+((rs=(os=i.messages[0])==null?void 0:os.id)!=null?rs:v)):i.type;case g.PIMBlock:{const w=cs(e);return he&&w?o.jsx(Eo,{isFinalTurn:r,hasActiveRequest:u,conversationMode:he,clientThreadId:a.id,justification:(ks=w.metadata)==null?void 0:ks.pim_justification,flaggedMessageId:(Ss=w.metadata)==null?void 0:Ss.pim_message_id,children:J}):null}case g.HazelnutEnablePrompt:{const w=i.messages[0],T=w==null?void 0:w.content;return(T==null?void 0:T.type)!=="hazelnut_enable_prompt"?null:o.jsx(Yo,{conversationId:a.id,hazelnutId:T.hazelnut_id,hazelnutName:T.name},"hazelnut-enable-".concat(w.id))}case g.HazelnutZipPreview:{const w=i.messages[0];return o.jsxs("div",{className:"flex flex-col gap-3",children:[J,o.jsx(Co,{conversation:a,message:w})]},"skill-zip-preview-".concat(w.id))}case g.n7jupd_n:return o.jsx(yn,{});case g.Browsing:case g.RetrievalBrowsing:{const w=he!=null&&[He.GizmoInteraction,He.GizmoMagicCreate,He.GizmoTest].includes(he.kind),T=Y?Ma(Y):!1;return o.jsx(zo,{messages:i.messages,isRequestActive:u,isLastMessageInTurn:I,isUsingGizmo:w,isUsingProject:T,gizmoId:Y,isRetrieval:i.type===g.RetrievalBrowsing},"browsing-"+((js=(Ts=i.messages[0])==null?void 0:Ts.id)!=null?js:v))}case g.kaur1br5:return o.jsx(Vo,{messages:i.messages,isRequestActive:u,isLastMessageInTurn:I,clientThreadId:a.id},"kaur1br5-tool-"+((Is=(Cs=i.messages[0])==null?void 0:Cs.id)!=null?Is:v));case g.SearchGPTQuery:{if(s.some(U=>U.type===ye)&&xe)return null;const T=s.slice(v+1).findLast(U=>U.type===g.Text||U.type===g.CoTSearchTool),O=new Set,ue=[];for(const U of e){const Oe=La(U);if(Oe&&Oe.length>0)for(const Ue of Oe)O.has(Ue)||(O.add(Ue),ue.push(Ue))}return o.jsx(Rt,{clientThreadId:a.id,turnIndex:p,isRequestActive:u,isLastMessage:I,isLastTurnInConversation:r,nextMessage:T==null?void 0:T.messages[0],searchModelQueries:ue,shouldShowAnimatedBlackDot:!X.current},"searchquery-"+((Es=(As=i.messages[0])==null?void 0:As.id)!=null?Es:v))}case g.StructuredThoughts:return null;case g.ReasoningRecap:return null;case g.n7jupd:return null;case g.n7jupd_native_api_tool:case g.n7jupd_a:case g.n7jupd_x:return null;case g.a8km123:{if(!i.messages.every(T=>{var O;return!((O=T.metadata)!=null&&O.reasoning_status)})){const T=ls(e,O=>O.author.role===ms.Assistant&&O.recipient==="all");return o.jsx(Qo,{conversation:a,turnIndex:p,isStreaming:(I||T<v)&&l,isFinalAssistantTurn:c,messages:i.messages},"sum-"+((Ms=(Ls=i.messages[0])==null?void 0:Ls.id)!=null?Ms:v))}return o.jsx(qo,{messages:i.messages,isStreaming:I&&l,isCompletionRequestInProgress:l,hasActiveRequest:u,isLastMessage:I,isFinalTurn:r,isFeedbackEnabled:d,conversation:a,currentGroupedMessageIndex:v,turnIndex:p},"sum-"+((Ns=(Ps=i.messages[0])==null?void 0:Ps.id)!=null?Ns:v))}case g.f959b8c:return ce(),null;case g.is_loading_message:if(I&&l){const w=i.messages[0],T=At(w);return o.jsx(xn,{text:T},"loading-message-"+v)}else return null;case g.b47u8ra0_t:{const w=i.messages[0],T="Reference Browser Memories?",O=At(w);return o.jsx(Rn,{title:T,description:O,settingsTab:(Rs=(Ds=w.metadata)==null?void 0:Ds.b47u8ra0_t)!=null?Rs:"general",clientThreadId:a.id,parentMessageId:w.id},"b47u8ra0_t-"+v)}case g.l1p9k3u:return null;case g.b1de6e2_c:return o.jsx(ao,{messages:i.messages,clientThreadId:a.id,isLastMessage:I},"b1de6e2-"+((Bs=(Os=i.messages[0])==null?void 0:Os.id)!=null?Bs:v));case g.b1de6e2_s:return o.jsx(vn,{messages:i.messages,clientThreadId:a.id},"b1de6e2_s-"+((zs=(Fs=i.messages[0])==null?void 0:Fs.id)!=null?zs:v));case g.b1de6e2_d:return null;case g.b1de6e2_rm:return o.jsx(pn,{messages:i.messages,clientThreadId:a.id,renderingView:S,children:J},"b1de6e2_rm-"+(($s=(Vs=i.messages[0])==null?void 0:Vs.id)!=null?$s:v));case g.async_task_result_message:return o.jsx(hn,{clientThreadId:a.id,messages:i.messages,children:J},"async_task_result_message-"+((Ws=(Us=i.messages[0])==null?void 0:Us.id)!=null?Ws:v));case g.de1d73e:if(le){const w=v+1<t.length?t[v+1]:void 0;return o.jsx(Jo,{clientThreadId:a.id,currentGroupedMessage:i,nextMessage:w&&w.type===g.Text?w.messages[0]:void 0,isLastMessage:I,isRequestActive:u},"jawbone-"+((qs=(Hs=i.messages[0])==null?void 0:Hs.id)!=null?qs:v))}else return null;case g.ParallelBrowsing:return o.jsx(Fo,{messages:i.messages},"parallel-"+((Zs=(Qs=i.messages[0])==null?void 0:Qs.id)!=null?Zs:v));case g.CodeInterpreter:return o.jsx(Ho,{messages:i.messages,isRequestActive:u||l,clientThreadId:a.id},"ada-"+((Ks=(Js=i.messages[0])==null?void 0:Js.id)!=null?Ks:v));case g.UserSettings:{const w=v+1<t.length?t[v+1]:void 0;return(w==null?void 0:w.type)===g.UserSettings?null:o.jsx(gn,{messages:i.messages,isRequestActive:u},"user-settings-"+((Xs=(Ys=i.messages[0])==null?void 0:Ys.id)!=null?Xs:v))}case g.q7dr546:return o.jsx(un,{messages:i.messages,isLastMessage:I,nextMessage:z},"q7dr546-"+((et=(Gs=i.messages[0])==null?void 0:Gs.id)!=null?et:v));case g.DILWidget:{const w=i.messages[0],T=(st=w==null?void 0:w.metadata)==null?void 0:st.chatgpt_sdk,O=T==null?void 0:T.dil,ue=T==null?void 0:T.dil_version,U=(tt=T==null?void 0:T.tool_response_metadata)==null?void 0:tt.kakao_widget;return U||O?o.jsx("div",{children:o.jsx(Pn,{rootWidget:U,dil:O,dilVersion:ue})},"dil-".concat((at=w==null?void 0:w.id)!=null?at:v)):null}case g.JITPlugin:return o.jsx(Uo,{messages:i.messages,nextMessage:(z==null?void 0:z.type)===g.JITPlugin?z.messages[0]:void 0,clientThreadId:a.id,isLastTurnInConversation:r,isLastMessageInTurn:I,onRequestCompletion:y},"jit-"+((ot=(nt=i.messages[0])==null?void 0:nt.id)!=null?ot:v));case g.Mercury:return null;case g.APIToolElicitation:return o.jsx(Wo,{messages:i.messages,nextMessage:(z==null?void 0:z.type)===g.APIToolElicitation?z.messages[0]:void 0,clientThreadId:a.id,isLastTurnInConversation:r,isLastMessageInTurn:I,onRequestCompletion:y},"api-tool-elicitation-"+((it=(rt=i.messages[0])==null?void 0:rt.id)!=null?it:v));case g.t2uay3k:return o.jsx(Bo,{messages:i.messages,clientThreadId:a.id,isParagen:x,isLastTurnInConversation:r},"t2uay3k-"+((ct=(lt=i.messages[0])==null?void 0:lt.id)!=null?ct:v));case g.Dalle:return o.jsx(Do,{messages:i.messages,clientThreadId:a.id,disableClickThru:x},"dalle-"+((mt=(dt=i.messages[0])==null?void 0:dt.id)!=null?mt:v));case g.GizmoEditor:return o.jsx(Mo,{messages:i.messages},"gizmo-editor-"+((ut=(ft=i.messages[0])==null?void 0:ft.id)!=null?ut:v));case g.oiw209h:return o.jsx(Ro,{messages:i.messages,clientThreadId:a.id},"oiw209h-"+((ht=(gt=i.messages[0])==null?void 0:gt.id)!=null?ht:v));case g.n7jupd_p:return o.jsx(fn,{});case g.Canmore:return o.jsx(mn,{messages:i.messages,allTurnMessages:e,isFinalTurn:r,isRequestActive:F,clientThreadId:a.id},"canmore-"+((vt=(pt=i.messages[0])==null?void 0:pt.id)!=null?vt:v));case g.Container:case g.Oboe:return null;case g.Croquette:return null;case g.Debug:return Ie?o.jsx(Po,{message:i.messages[0]},"debug-"+i.messages[0].id):null;case g.SearchResult:return o.jsx($o,{messages:i.messages},"search-result-"+((yt=(xt=i.messages[0])==null?void 0:xt.id)!=null?yt:v));case g.Mochi:return null;case g.CoTSearchTool:return null;case g.SuperWidget:return null;case g.n7jupd_image_gen:return null;case g.e1ld0dvz:return null;case g.Glaux:return o.jsx(Oo,{messages:i.messages,isLastMessage:I},"glaux-"+i.messages[0].id);case g.Strix:return null;case g.xdeo6rao:return null}});L&&!N&&me.push(o.jsx(bn,{turnExchangeId:Ce,conversation:a,turnIndex:p}));const C=Cn(),{wordFadeType:H,animationDurationMs:G}=kn(),q=A.useRef([]),be=A.useRef(void 0),Q=A.useRef(null),R=!n&&r&&l,Z=(ae=e[0])==null?void 0:ae.id;return Pa(()=>{if(H!=="indexed"||!R)return;const i=Q.current;if(!i)return;be.current!==Z&&(be.current=Z,q.current=[]);const v=i.getAnimations({subtree:!0}).filter(F=>F.animationName===Ot["fade-in"]);if(v.length!==0){const F=ar({now:performance.now(),previousStartTimes:q.current,groupCount:v.length});q.current=F;for(let I=0;I<v.length;I++)v[I].startTime=F[I]}else q.current=[]},[me,H,R]),o.jsx("div",{className:It("flex max-w-full flex-col",{[Ot.root]:H==="indexed"&&R,grow:_}),style:H==="indexed"?{"--duration":"".concat(G,"ms")}:void 0,ref:Q,children:o.jsx(Na,{name:"GroupedMessages",fallback:sr,children:n?me:o.jsxs(Sn,{isDisabled:!R||H!=="delay",defaultAnimationDurationPerSegmentMs:G,children:[Tn()&&r&&o.jsx(jn,{isStreaming:l,debug:C}),me]},(ve=e[0])==null?void 0:ve.id)})})}function sr({error:s}){return o.jsxs(An,{type:"danger",children:[o.jsx(ie,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."}),!1]})}function tr(s,e,t){if(s.length<2||e<=0)return 0;const a=e/Math.log(2);s=[...s].sort((d,r)=>d-r);let n=0,l=0;for(let d=s.length-1;d>0;--d){const r=Math.exp(-(t-s[d])/a);if(n>0&&r/n<.01)break;const f=s[d]-s[d-1];n+=r,l+=r*f}return n===0?0:n/l}function ar({now:s,previousStartTimes:e,groupCount:t,initialRate:a=50,halfLife:n=1}){var h;const l=e.slice(0,ls(e,m=>m<=s)+1),d=l.length<2?a/1e3:Math.max(.01,tr(l,n*1e3,s)),r=t-l.length;let f=(h=l[l.length-1])!=null?h:0,c=1;for(let m=0;m<r;m++){const u=d*1e3*c;r<u?c*=.8:r>u&&(c*=1.5);const y=1/(d*c),p=Math.max(s,f+y);l.push(p),f=p}return l}export{ur as C,zn as a,Vn as s,Wn as u};
//# sourceMappingURL=9ed9a415-dm4br15ut09gdl61.js.map
