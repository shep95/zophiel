import{b as N,j as s,e as v,r as _,h as b}from"./2340486e-n0khdanno9uzbccp.js";import{da as j,db as I,H as F,b as S,rG as w,dp as U,du as k,T as O,R as M,A as C,hd as A,g_ as E,hP as L,J as H,aI as R,aK as B,lT as D,e$ as q}from"./4813494d-di0bpg5zidu9s57f.js";import{u as T}from"./b81d67c1-g85xaexv7seu9n1r.js";import{b7 as G,b8 as K,b9 as P,ba as W,bb as z,bc as Q}from"./1a7ebd5f-ihenykhpblfwilpu.js";const u=j(I(()=>({feedItems:[],hasUnreadNotifications:!1,isModalOpen:!1}))),Z=u.getState,h=u.setState,$={getHasUnreadNotifications:(t=Z())=>t.hasUnreadNotifications},l={setIsModalOpen:t=>{h({isModalOpen:t})},setHasUnreadNotifications:t=>{h({hasUnreadNotifications:t})},bulkLoadFeedItems:t=>{h(e=>{e.feedItems=t})}};function J(){const t=p(),e=u($.getHasUnreadNotifications);return t&&e}function V(t,e,a,o){const d=J(),c=S(()=>w().some(f=>{var n;return((n=U(f))==null?void 0:n.value)===k.UNREAD}));return a&&d||o&&c?t:e}function p(){return F("3606233934",{disableExposureLog:!0}).get("enable_notifications_feed")}function ne(){const t=p(),e=u(a=>a.isModalOpen);return t&&e}function Y(){const t=p(),e=v({queryKey:["fetch-notifications-feed"],queryFn:async()=>{const a=await M.safeGet("/notifications/feed");return l.bulkLoadFeedItems(a.items),l.setHasUnreadNotifications(a.has_unreads),a.items},enabled:t});return{isLoading:e.isLoading,isFetching:e.isFetching}}function oe(){const t=N(),e=V(K,G,!0,!1),a=t.formatMessage({id:"1UHY6w",defaultMessage:"Notifications"});return Y(),s.jsx(O,{label:a,className:"group",children:s.jsx(P,{icon:e,onClick:()=>l.setIsModalOpen(!0),"aria-label":a})})}function X({conversation:t,item:e,onClose:a}){const d={announcement:z}[e.type];let c=null;try{const i=new Date(e.created_at);c=Q({date:i})}catch(i){}const m=T(t.id),f=b(),n=i=>{var r,x,y;if(((r=e.action)==null?void 0:r.type)==="show_conversation")a(),f(e.action.conversation_id);else if(((x=e.action)==null?void 0:x.type)==="new_conversation"){const g=e.action;g.prefilled_message&&(m({sourceEvent:i,promptMessage:q(g.prefilled_message),requestedModelId:(y=g.model_slug)!=null?y:void 0}),a())}};return s.jsxs("button",{className:"border-token-border-default flex w-full items-center justify-start gap-3 overflow-hidden border-t py-4 first-of-type:border-none",onClick:n,disabled:!e.action,children:[s.jsx("div",{className:"relative",children:d&&s.jsx(d,{className:"icon"})}),s.jsxs("div",{className:"flex h-5 shrink grow basis-0 items-center justify-between",children:[s.jsx("div",{className:"text-token-text-primary text-sm leading-tight font-normal",children:e.message}),s.jsx("div",{className:"flex items-center justify-start gap-1",children:s.jsx("div",{className:"text-token-text-tertiary text-sm leading-tight font-normal",children:c!=null?c:""})})]})]})}function ie({conversation:t}){const{feedItems:e,isModalOpen:a}=u();_.useEffect(()=>{a&&(l.setHasUnreadNotifications(!1),M.safePost("/notifications/feed/read",{authOption:C.SendIfAvailable}))},[a]);const o=N(),d=b(),c=new Date,m=A(e,n=>{const i=new Date(n.created_at);if(E(i))return"today";const r=L(c,i);return r<=7?"last_7_days":r<=30?"last_30_days":"more_than_30_days"}),f=n=>{switch(n){case"today":return o.formatMessage({id:"zlkA39",defaultMessage:"Today"});case"last_7_days":return o.formatMessage({id:"FW89A4",defaultMessage:"Last 7 days"});case"last_30_days":return o.formatMessage({id:"2s3h/P",defaultMessage:"Last 30 days"});case"more_than_30_days":return o.formatMessage({id:"yArZiR",defaultMessage:"More than 30 days"})}};return s.jsx(H,{testId:"modal-notifications-feed",isOpen:a,onClose:()=>{l.setIsModalOpen(!1)},type:"success",size:"custom",className:"max-w-3xl",children:s.jsxs("div",{className:"flex flex-col gap-y-10",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-2xl font-bold",children:o.formatMessage({id:"kWt8Cx",defaultMessage:"Notifications"})}),s.jsx(W,{icon:s.jsx(D,{className:"icon"}),onClick:()=>{d(R(B.Notifications))},label:o.formatMessage({id:"mZVh0S",defaultMessage:"Notifications settings"})})]}),Object.entries(m).map(([n,i])=>s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold",children:f(n)}),i.map(r=>s.jsx(X,{conversation:t,item:r,onClose:()=>l.setIsModalOpen(!1)},r.id))]},n))]})})}export{oe as N,ne as a,ie as b,p as i,V as u};
//# sourceMappingURL=e28ac415-ik0a0wphlu2bo4an.js.map
