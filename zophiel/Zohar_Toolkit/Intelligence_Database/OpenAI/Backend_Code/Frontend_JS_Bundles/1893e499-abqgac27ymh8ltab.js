var _e=Object.defineProperty,Pe=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var re=(s,e,n)=>e in s?_e(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,C=(s,e)=>{for(var n in e||(e={}))Re.call(e,n)&&re(s,n,e[n]);if(ie)for(var n of ie(e))Se.call(e,n)&&re(s,n,e[n]);return s},U=(s,e)=>Pe(s,ke(e));import{b as Y,h as pe,r as x,i as Ne,j as t,d as ge,M as q,c as T,v as Fe}from"./2340486e-n0khdanno9uzbccp.js";import{j as ne,cO as he,R as xe,cu as ee,cw as Te,cS as De,hT as Ee,fV as je,fa as Me,fU as we,am as Oe,cT as Ae,jy as Ie,s9 as le,sa as Ge,qW as qe,dm as Be,kT as ce,ha as de,lP as Ue,b as te,t_ as We,ji as ze,jh as ue,jj as He,o1 as Le,g9 as me,dZ as se,al as $e,aW as Ve}from"./4813494d-di0bpg5zidu9s57f.js";import{j5 as Ye,j6 as Ke,gm as Xe,b9 as v,j7 as Ze,j8 as Qe,fW as fe,_ as ae,j9 as Je,ao as ye,ja as et,cT as tt,cU as st,cV as at,ba as nt,jb as ot,jc as it,jd as rt,je as lt,jf as ct}from"./1a7ebd5f-ihenykhpblfwilpu.js";import{I as dt,g as ut}from"./8a0ea239-k5nzxb1mwtc1km4s.js";import{m as mt}from"./e21b3b3f-20f2eud26zbq9d5f.js";const ft=({image:s,onClose:e,onRequestCompletion:n,clientThreadId:u,currentModelId:o,post:c,canDelete:i,onOpenReport:r})=>{var F;const a=Y(),l=ne(),d=pe(),p=!he(),[j,m]=x.useState("default"),f=Ye(),g=x.useRef(null),y=x.useRef(f);x.useEffect(()=>{y.current=f},[f]);const K=x.useCallback(()=>Ke(a),[a]),D=x.useCallback(()=>{s&&m("inpaint")},[s]),_=x.useCallback(()=>{m("default"),y.current.clearAllDrawings()},[]),R=x.useCallback(()=>{s&&Xe({url:s.url,fileName:K()})},[s,K]),E=x.useCallback(()=>{var b;return(b=g.current)==null?void 0:b.getImageData()},[]),B=x.useCallback(async()=>{if(window.confirm(a.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await xe.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:c.id}}}),d("/",{replace:!0})}catch(b){l.danger(Ne({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post"}),{toastId:"post_receiver_modal.delete_post_error"})}},[c.id,a,l,d]),S=j==="inpaint"?a.formatMessage({id:"TjVqYb",defaultMessage:"Edit Selection"}):(F=c.text)!=null?F:a.formatMessage({id:"htGxHc",defaultMessage:"Image"}),N=x.useCallback(b=>{b.key==="Escape"&&(e(),b.preventDefault())},[e]);return x.useEffect(()=>(document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)),[N]),t.jsx(ee.Root,{isOpen:!0,onClose:e,testId:"modal-lightbox-post-share",shouldIgnoreClickOutside:j==="inpaint",children:t.jsx(ee.Overlay,{children:t.jsxs(ee.Content,{size:"fullscreen",removePopoverStyling:!0,className:"grid min-h-0 grid-rows-[auto_minmax(0,1fr)] overflow-hidden",children:[t.jsxs("header",{className:"flex h-14 w-full items-center justify-between gap-2 px-2 md:px-4",children:[t.jsx("div",{className:"flex min-w-0 items-center gap-2",children:p?t.jsxs(t.Fragment,{children:[t.jsx(v,{onClick:e,"aria-label":a.formatMessage(k.close),children:t.jsx(Te,{className:"h-5 w-5"})}),t.jsx("h2",{className:"mb-px text-base font-medium",children:t.jsx(q,C({},De.chatGPT))})]}):t.jsxs(t.Fragment,{children:[t.jsx(v,{icon:Ee,onClick:e,"aria-label":a.formatMessage(k.close)}),t.jsx("h2",{className:"line-clamp-1 text-base font-medium",children:S})]})}),t.jsx("div",{className:"flex items-center gap-2",children:j==="inpaint"?t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"aspect-square",icon:Ze,onClick:f.undoDrawing,disabled:!f.canUndoDrawing,"aria-label":a.formatMessage({id:"OmaTPx",defaultMessage:"Undo"})}),t.jsx(v,{className:"aspect-square",icon:Qe,onClick:f.redoDrawing,disabled:!f.canRedoDrawing,"aria-label":a.formatMessage({id:"ZUr4oh",defaultMessage:"Redo"})}),t.jsx(v,{className:"w-auto px-3",onClick:_,children:a.formatMessage({id:"D9xvar",defaultMessage:"Cancel"})})]}):t.jsx(t.Fragment,{children:p?t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"aspect-square",icon:fe,onClick:R,"aria-label":a.formatMessage(k.downloadImage)}),t.jsx(je,{size:"small",contentAlign:"end",sideOffset:4,triggerButton:t.jsx(v,{className:"aspect-square","aria-label":a.formatMessage(k.moreOptions),children:t.jsx(we,{className:"icon"})}),children:t.jsx(Me.Item,{icon:ae,onClick:r,children:t.jsx(q,C({},k.reportContent))})})]}):t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"aspect-square",icon:Je,onClick:D,"aria-label":a.formatMessage({id:"pRGwlp",defaultMessage:"Edit image"})}),t.jsx(v,{className:"aspect-square",icon:fe,onClick:R,"aria-label":a.formatMessage(k.downloadImage)}),t.jsx(v,{className:"aspect-square",icon:ae,onClick:r,"aria-label":a.formatMessage(k.reportContent)}),i&&t.jsx(v,{className:"aspect-square",icon:ye,onClick:B,"aria-label":a.formatMessage({id:"rzlDpj",defaultMessage:"Delete post"})})]})})})]}),t.jsxs("div",{className:"grid h-full w-full grid-rows-[1fr_auto] items-center overflow-y-auto overscroll-contain",children:[t.jsx("div",{className:"flex h-full w-full items-center justify-center px-4 pb-4",children:s&&t.jsxs("div",{className:"relative inline-block max-h-full rounded bg-neutral-100",children:[t.jsx("img",{src:s.url,alt:S,className:"h-full max-h-[70vh] w-auto max-w-full rounded object-contain",fetchPriority:"high"}),j==="inpaint"&&t.jsx(et,{image:s,drawingState:f,drawingCanvasRef:g}),p&&t.jsx("div",{className:"mt-4 flex w-full justify-center",children:t.jsx(Oe,{type:"button",color:"primary",size:"large",className:"w-full md:w-auto",onClick:()=>Ae({fallbackScreenHint:"login",skipLoginModal:!1}),children:t.jsx(q,C({},k.makeImagesOnChatGPTCta))})})]})}),!p&&t.jsx("div",{className:"flex w-full justify-center px-4 pb-8",children:t.jsx("div",{className:"w-full max-w-[768px]",children:t.jsx(dt,{clientThreadId:u,currentModelId:o,onRequestCompletion:n,onClose:e,activeImage:s,currentDrawnShape:f.currentDrawnShape,getImageData:E,onCancelInpaint:_})})})]})]})})})},k=ge({close:{id:"EYLKSm",defaultMessage:"Close"},downloadImage:{id:"9DNHka",defaultMessage:"Download image"},makeImagesOnChatGPTCta:{id:"8coyYY",defaultMessage:"Make images on ChatGPT"},moreOptions:{id:"pAyhm2",defaultMessage:"More options"},reportContent:{id:"2gNXdX",defaultMessage:"Report content"}});function Ct(s){"use forget";var c,i;const e=T.c(7),{postWithProfile:n,clientThreadId:u,onClose:o}=s;if(((c=n.post.attachments[0])==null?void 0:c.kind)==="media_generation"){let r;return e[0]!==u||e[1]!==o||e[2]!==n?(r=t.jsx(qe,{children:t.jsx(pt,{postWithProfile:n,clientThreadId:u,onClose:o})}),e[0]=u,e[1]=o,e[2]=n,e[3]=r):r=e[3],r}else if(((i=n.post.attachments[0])==null?void 0:i.kind)==="message_slice"){let r;return e[4]!==o||e[5]!==n?(r=t.jsx(ht,{postWithProfile:n,onClose:o}),e[4]=o,e[5]=n,e[6]=r):r=e[6],r}return null}function pt(s){"use forget";var oe;const e=T.c(57),{postWithProfile:n,clientThreadId:u,onClose:o}=s,c=Be(u),i=x.useRef(null),[r,a]=x.useState(!1),{post:l}=n,d=l.attachments[l.attachments.length-1];let p;e[0]!==d.asset_pointer||e[1]!==d.id?(p=(oe=d.asset_pointer)!=null?oe:ce(d.id),e[0]=d.asset_pointer,e[1]=d.id,e[2]=p):p=e[2];let j;e[3]!==d.height||e[4]!==d.url||e[5]!==d.width||e[6]!==p?(j={url:d.url,content_type:de.ImageAssetPointer,asset_pointer:p,size_bytes:0,width:d.width,height:d.height},e[3]=d.height,e[4]=d.url,e[5]=d.width,e[6]=p,e[7]=j):j=e[7];const m=j,f=Y(),g=Ue(),y=te(c.serverId$),D=te(We(c.id))==="potion"?"health":void 0,_=ne();let R;e[8]!==g?(R=w=>g.getState().files.find(M=>M.tempId===w),e[8]=g,e[9]=R):R=e[9];const E=R,B=d.url;let S;e[10]!==g||e[11]!==E||e[12]!==f||e[13]!==y||e[14]!==_||e[15]!==D?(S=async w=>{if(i.current){const M=await i.current,I=M?E(M==null?void 0:M.tempId):null;if(I)return I}return i.current=fetch(w).then(gt).then(M=>{const I=new File([M],"image.png",{type:"image/png"}),h=ze(I);return ue.uploadFile(g,h,I,He.Multimodal,[I.type],f,_,C(C({},y?{conversationId:y}:{}),D?{uploadSource:D}:{})).then(()=>{const P=E(h);return P&&P.status===Le.Ready&&P.fileId?P:null})}),i.current},e[10]=g,e[11]=E,e[12]=f,e[13]=y,e[14]=_,e[15]=D,e[16]=S):S=e[16];const N=S;let F;e[17]!==c?(F=()=>me(c).id,e[17]=c,e[18]=F):F=e[18];const b=te(F);let W;e[19]===Symbol.for("react.memo_cache_sentinel")?(W=he(),e[19]=W):W=e[19];const be=!W;let z;e[20]!==N||e[21]!==B||e[22]!==d.height||e[23]!==d.width?(z=async w=>{const M=await N(B);if(!M||!M.fileId||!M.fileSpec)return null;const I=[{content_type:de.ImageAssetPointer,asset_pointer:ce(M.fileId),size_bytes:M.fileSpec.size,width:d.width,height:d.height},...w.content.content_type===se.MultimodalText||w.content.content_type===se.Text?w.content.parts:[]],h={content_type:se.MultimodalText,parts:I};return U(C({},w),{content:h})},e[20]=N,e[21]=B,e[22]=d.height,e[23]=d.width,e[24]=z):z=e[24];const X=z;let H;e[25]===Symbol.for("react.memo_cache_sentinel")?(H=ut(),e[25]=H):H=e[25];const Ce=H;let L;e[26]!==X||e[27]!==c||e[28]!==g||e[29]!==l.id||e[30]!==_?(L=w=>{if(!w.promptMessage||be)return;const M=async()=>{var P;const h=await X(w.promptMessage);return h?U(C({conversation:c},w),{promptMessage:h,extraStreamParams:U(C({},(P=w.extraStreamParams)!=null?P:{}),{continueFromSharedPostId:l.id})}):null},I=(h,P)=>{$e.addError(h,P),_.danger(jt.editImageError,{toastId:"post_receiver_modal.edit_image_error",hasCloseButton:!0})};Ce(Fe(),{model:me(c),optimisticMessages:[w.promptMessage,mt("Analyzing")],asyncWork:async()=>{const h=await M();return ue.reset(g),h},lifecycleCallbacks:{onOptimisticRenderError:h=>I(h,{stage:"optimistic_render"}),onAsyncWorkError:h=>I(h,{stage:"async_work"}),onCompletionError:h=>I(h,{stage:"completion"})}})},e[26]=X,e[27]=c,e[28]=g,e[29]=l.id,e[30]=_,e[31]=L):L=e[31];const Z=L;let $;e[32]!==m.asset_pointer||e[33]!==m.height||e[34]!==m.url||e[35]!==m.width||e[36]!==l.id||e[37]!==y?($={id:l.id,archived:!1,transformationId:null,url:m.url,assetPointer:m.asset_pointer,thumbnail:null,width:m.width,height:m.height,title:null,conversationId:y,messageId:l.id},e[32]=m.asset_pointer,e[33]=m.height,e[34]=m.url,e[35]=m.width,e[36]=l.id,e[37]=y,e[38]=$):$=e[38];const Q=$,J=!!l.permissions.can_delete;let O;e[39]!==a?(O=()=>a(!0),e[39]=a,e[40]=O):O=e[40];let A;e[41]!==Q||e[42]!==c.id||e[43]!==b||e[44]!==Z||e[45]!==o||e[46]!==l||e[47]!==J||e[48]!==O?(A=t.jsx(ft,{image:Q,onClose:o,onRequestCompletion:Z,clientThreadId:c.id,currentModelId:b,post:l,canDelete:J,onOpenReport:O}),e[41]=Q,e[42]=c.id,e[43]=b,e[44]=Z,e[45]=o,e[46]=l,e[47]=J,e[48]=O,e[49]=A):A=e[49];let G;e[50]!==r||e[51]!==l||e[52]!==a?(G=r&&t.jsx(ve,{post:l,onClose:()=>a(!1)}),e[50]=r,e[51]=l,e[52]=a,e[53]=G):G=e[53];let V;return e[54]!==A||e[55]!==G?(V=t.jsxs(t.Fragment,{children:[A,G]}),e[54]=A,e[55]=G,e[56]=V):V=e[56],V}function gt(s){return s.blob()}function ht(s){"use forget";const e=T.c(12),{postWithProfile:n,onClose:u}=s,[o,c]=x.useState(!1),{post:i}=n;let r;e[0]!==u||e[1]!==i?(r=t.jsx(xt,{post:i,setIsReportModalOpen:c,onClose:u}),e[0]=u,e[1]=i,e[2]=r):r=e[2];let a;e[3]!==i.attachments?(a=t.jsx(ot,{attachments:i.attachments,variant:"fullscreen"}),e[3]=i.attachments,e[4]=a):a=e[4];let l;e[5]!==o||e[6]!==i?(l=o&&t.jsx(ve,{post:i,onClose:()=>c(!1)}),e[5]=o,e[6]=i,e[7]=l):l=e[7];let d;return e[8]!==r||e[9]!==a||e[10]!==l?(d=t.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[r,a,l]}),e[8]=r,e[9]=a,e[10]=l,e[11]=d):d=e[11],d}function xt(s){"use forget";const e=T.c(22),{post:n,setIsReportModalOpen:u,onClose:o,additionalButtons:c}=s,i=pe(),r=Y(),a=ne();let l;e[0]!==r||e[1]!==i||e[2]!==n.id||e[3]!==a?(l=async()=>{if(window.confirm(r.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await xe.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:n.id}}}),i("/",{replace:!0})}catch(y){a.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},e[0]=r,e[1]=i,e[2]=n.id,e[3]=a,e[4]=l):l=e[4];const d=l;let p;e[5]!==i||e[6]!==o?(p=t.jsx("div",{className:"flex items-center justify-self-start text-start",children:t.jsx(lt,{onClose:()=>{o(),i("/",{replace:!0})}})}),e[5]=i,e[6]=o,e[7]=p):p=e[7];let j;e[8]!==n||e[9]!==u?(j=t.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:t.jsx(ct,{areButtonsFullWidth:!0,post:n,setIsReportModalOpen:u})}),e[8]=n,e[9]=u,e[10]=j):j=e[10];let m;e[11]!==d||e[12]!==r||e[13]!==n.permissions.can_delete?(m=n.permissions.can_delete&&t.jsx(it,{tooltip:r.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:d,children:t.jsx(ye,{})}),e[11]=d,e[12]=r,e[13]=n.permissions.can_delete,e[14]=m):m=e[14];let f;e[15]!==c||e[16]!==m?(f=t.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[m,c]}),e[15]=c,e[16]=m,e[17]=f):f=e[17];let g;return e[18]!==p||e[19]!==j||e[20]!==f?(g=t.jsx(t.Fragment,{children:t.jsxs(Ve.div,U(C({className:"flex h-16 w-full px-2 sm:px-4"},rt),{children:[p,j,f]}))}),e[18]=p,e[19]=j,e[20]=f,e[21]=g):g=e[21],g}function ve(s){"use forget";var l;const e=T.c(7),{post:n,onClose:u}=s,{data:o}=tt(le.Post),c=Y(),i=st(c,n.id,le.Post,Ge.ChatGPTPost);if(o==null)return null;const r="Report ".concat((l=n.text)!=null?l:"Post");let a;return e[0]!==u||e[1]!==o.header||e[2]!==o.header_explanation||e[3]!==o.reasons||e[4]!==i||e[5]!==r?(a=t.jsx(at,{reasons:o.reasons,submitReport:i,title:r,onClose:u,header:o.header,subHeader:o.header_explanation}),e[0]=u,e[1]=o.header,e[2]=o.header_explanation,e[3]=o.reasons,e[4]=i,e[5]=r,e[6]=a):a=e[6],a}function _t(){"use forget";var l;const s=T.c(7),e=x.useContext(Ie),n=(l=e==null?void 0:e.postWithProfile)==null?void 0:l.post,u=e==null?void 0:e.setIsReportModalOpen;if(!n||!u)return null;let o;s[0]===Symbol.for("react.memo_cache_sentinel")?(o=t.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:t.jsx(q,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),s[0]=o):o=s[0];let c;s[1]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(nt,{className:"rounded-full",label:"",icon:t.jsx(we,{className:"icon-sm"})}),s[1]=c):c=s[1];let i;s[2]!==u?(i=()=>u(!0),s[2]=u,s[3]=i):i=s[3];let r;s[4]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx(q,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"}),s[4]=r):r=s[4];let a;return s[5]!==i?(a=t.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[o,t.jsx(je,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:c,children:t.jsx(Me.Item,{icon:ae,onClick:i,children:r})})]}),s[5]=i,s[6]=a):a=s[6],a}function Pt(){"use forget";var c;const s=T.c(2),e=x.useContext(Ie),n=(c=e==null?void 0:e.postWithProfile)==null?void 0:c.post,u=e==null?void 0:e.setIsReportModalOpen;if(!n||!u)return null;let o;return s[0]!==u?(o=t.jsx("div",{className:"text-token-text-secondary text-sm",children:t.jsx(q,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:i=>t.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{u(!0)},children:i})}})}),s[0]=u,s[1]=o):o=s[1],o}const jt=ge({editImageError:{id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image"}});export{ve as P,Pt as S,Ct as a,_t as b};
//# sourceMappingURL=1893e499-abqgac27ymh8ltab.js.map
