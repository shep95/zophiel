var V=Object.defineProperty,W=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var q=(n,e,t)=>e in n?V(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,N=(n,e)=>{for(var t in e||(e={}))J.call(e,t)&&q(n,t,e[t]);if(R)for(var t of R(e))X.call(e,t)&&q(n,t,e[t]);return n},H=(n,e)=>W(n,z(e));import{h_ as T,rb as Z,aJ as Q,e6 as Y,e8 as ee,ha as te,dZ as ne,e$ as K,jv as L,P as se,t$ as oe,d$ as ae,fB as re,dm as ie,qW as me,on as ce,bh as de,qX as le}from"./4813494d-di0bpg5zidu9s57f.js";import{jg as D,jh as pe,ji as k,jj as ge,c0 as ue,jk as Ie,jl as he,jm as fe,jn as ve,jo as Ce,jp as _e,jq as Pe,jr as Ge,js as Me}from"./1a7ebd5f-ihenykhpblfwilpu.js";import{g as ye,I as Te,u as je,a as xe,m as Se,w as Ae,P as we}from"./e21b3b3f-20f2eud26zbq9d5f.js";import{v as U,c as Ee,j as P}from"./2340486e-n0khdanno9uzbccp.js";const B=T(n=>(e,t)=>{var i;const s=ye(n,e);if(s)return s;const a=(i=t.conversation)!=null?i:$e(),o=new Te({conversation:a,requestKey:e,input:t});return je(n,o),o.run$(),o}),ke=T(()=>{const n=B();return({conversation:e,prompt:t,images:s})=>{if(s.length===0)return;const{promptItem:a,group:o}=D(e);if(a==null)return;const i=U(),m={content_type:ne.MultimodalText,parts:[t,...s.map(l=>({content_type:te.ImageAssetPointer,asset_pointer:l.asset_pointer,width:l.width,height:l.height,size_bytes:0}))]},c=U(),d=K(m,{image_feature:"prompt",image_prompt_id:a.id,image_send_uuid:c});O(o,a,c),n(i,{model:L(),optimisticMessages:[d],asyncWork:()=>Promise.resolve({eventSource:"url",promptMessage:d})})}});function O(n,e,t){se.logStructuredEvent(oe,{promptId:e.id,promptGroupId:n.id,promptGroupPresentation:fe(n.presentation),imageSendUuid:t})}const Ke=T(()=>{const n=B();return({conversation:e,tempIds:t,filePickerStore:s,persistedFileStore:a})=>{if(t.length===0)return;const{promptItem:o,group:i}=D(e);if(o==null)return;const m=pe(t),c=k(e)();if(c&&c!==m)return;k(e).set(m);const d=L(),l=ge(e),g=xe({filePickerStore:s,persistedFileStore:a,fileTempIds:t,text:o.prompt_text});n(m,{model:d,optimisticMessages:[g,Se("Uploading")],asyncWork:async()=>{const r=await Ae(t,s);if(!r.success)throw r.error;const{content:u,attachments:_}=ue(s,o.prompt_text,d,l,null);s.setState(H(N({},s.getState()),{files:[]}));const p=U();return O(i,o,p),{eventSource:"url",promptMessage:K(u,{attachments:_,image_feature:"prompt",image_prompt_id:o.id,image_send_uuid:p})}}})}}),Le=T(()=>({source:n})=>{const e=n==="camera"?Ie:he,t=document.getElementById(e);t instanceof HTMLInputElement&&t.click()});async function De(n,e){if(!ae(n))return;const t=re.getImageAssetPointers(n);t.length>0&&await Promise.allSettled(t.map(s=>ve(e,s,n)))}function $e(){var t,s;const n=Z(),{session:e}=Q();return Y.initThread({clientThreadId:n.id,conversationMode:{kind:ee.PrimaryAssistant},userId:(t=e==null?void 0:e.user)==null?void 0:t.id,accountId:(s=e==null?void 0:e.account)==null?void 0:s.id,disableConversationNavigation:!0}),n}function Be(n){"use forget";const e=Ee.c(32),{clientThreadId:t,currentModelId:s,onRequestCompletion:a,activeImage:o,currentDrawnShape:i,getImageData:m,onCancelInpaint:c,onClose:d}=n,l=i===void 0?null:i;let g;e[0]!==t?(g=ie(t),e[0]=t,e[1]=g):g=e[1];const r=g;let u;e[2]!==o?(u=o!=null?o:{},e[2]=o,e[3]=u):u=e[3];const{assetPointer:_,transformationId:p,height:j,width:b}=u,x=j===void 0?0:j,S=b===void 0?0:b,A=_!=null?_:"";let G;e[4]!==p?(G={dalle:{gen_id:p},generation:{gen_id:p}},e[4]=p,e[5]=G):G=e[5];const w=G;let I;e[6]!==x||e[7]!==A||e[8]!==w||e[9]!==S?(I={asset_pointer:A,metadata:w,height:x,width:S},e[6]=x,e[7]=A,e[8]=w,e[9]=S,e[10]=I):I=e[10];const E=c!=null?c:Ue,$=m!=null?m:Fe;let M;e[11]!==l||e[12]!==E||e[13]!==$||e[14]!==I?(M={image:I,currentDrawnShape:l,onCleared:E,getImageData:$},e[11]=l,e[12]=E,e[13]=$,e[14]=I,e[15]=M):M=e[15],Ce(M);let h;e[16]!==a?(h=F=>a(Ge(F)),e[16]=a,e[17]=h):h=e[17];let f;e[18]!==d||e[19]!==a?(f=async F=>{a(await Me(F)),d()},e[18]=d,e[19]=a,e[20]=f):f=e[20];let v;e[21]!==r||e[22]!==s||e[23]!==h||e[24]!==f?(v=P.jsx(_e,{children:P.jsx(we,{conversation:r,isNewThread:!0,currentModelId:s,onContinueGenerating:h,onRequestCompletion:f,hideHeader:!0,disableAdvancedVoiceMode:!0,plusButtonAddsFiles:!0,placeholder:Pe.imagesAppLightboxPlaceholder})}),e[21]=r,e[22]=s,e[23]=h,e[24]=f,e[25]=v):v=e[25];let C;e[26]!==r||e[27]!==v?(C=P.jsx(me,{children:P.jsx(ce,{conversation:r,forcedSystemHintType:de.PictureV2,children:v})}),e[26]=r,e[27]=v,e[28]=C):C=e[28];let y;return e[29]!==r||e[30]!==C?(y=P.jsx(le,{conversation:r,children:C}),e[29]=r,e[30]=C,e[31]=y):y=e[31],y}function Fe(){}function Ue(){}export{Be as I,ke as a,Ke as b,Le as c,B as g,De as m};
//# sourceMappingURL=8a0ea239-k5nzxb1mwtc1km4s.js.map
