var k=Object.defineProperty,_=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var p=(e,s,t)=>s in e?k(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,A=(e,s)=>{for(var t in s||(s={}))B.call(s,t)&&p(e,t,s[t]);if(T)for(var t of T(s))C.call(s,t)&&p(e,t,s[t]);return e},P=(e,s)=>_(e,b(s));var R=(e,s)=>{var t={};for(var a in e)B.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&T)for(var a of T(e))s.indexOf(a)<0&&C.call(e,a)&&(t[a]=e[a]);return t};import{r as u,j as m,H as U}from"./2340486e-n0khdanno9uzbccp.js";import{it as F,iu as L,iv as q,iw as j,ix as S,iy as H,iz as z,iA as N,iB as O}from"./1a7ebd5f-ihenykhpblfwilpu.js";import{n4 as V,kd as W,jW as w,dI as X,dq as $,ds as G,ej as J}from"./4813494d-di0bpg5zidu9s57f.js";import{T as E}from"./089c718c-clpuzb1fnoaty06o.js";function K(e){var h;const f=e,{bufferType:s,isActivelyStreaming:t,messages:a,parts:r}=f,d=R(f,["bufferType","isActivelyStreaming","messages","parts"]),i=a[a.length-1].id,y=u.useMemo(()=>a.some(c=>{var M;return(M=c.metadata)==null?void 0:M.mercury_message}),[a]),[v,g]=u.useState(F(r)),n=u.useRef(void 0),l=V(),{showPerformanceOverlay:x}=W();u.useEffect(()=>{if(!(!x||s!=="Adaptive"||!t))return w.setActiveStreamingMessageId(i),()=>w.setActiveStreamingMessageId(null)},[x,s,t,i]);const o=u.useMemo(()=>l?r.flatMap(c=>{if(typeof c=="string")return c;if(c.content_type==="audio_transcription")return c.text}).filter(c=>c!==void 0):r,[r,l]);if(n.current===void 0)switch(s){case"Adaptive":y?n.current=new j(o,g,t,void 0,{minRate:.4,expectedDisplayInterval:.05,maxTokensPerStep:7,messageId:i}):n.current=new j(o,g,t,void 0,{messageId:i});break;case"ChunkedCatchup":n.current=new q(o,g,t);break;case"Punctuation":n.current=new L(o,g,t);break}return u.useEffect(()=>{n.current!=null&&(n.current.onMessagePartsUpdated(o,t),n.current.isBuffering()&&S.addDelayedRenderingMessage(i))},[o,i,t]),u.useEffect(()=>{n.current!=null&&n.current.removeDelayedRender()&&S.removeDelayedRenderingMessage(i)},[v,i]),u.useEffect(()=>()=>S.removeDelayedRenderingMessage(i),[i]),u.useEffect(()=>()=>{var c;(c=n.current)==null||c.destroy(),n.current=void 0},[]),m.jsx(E,P(A({},d),{messages:a,parts:r,displayParts:v,isActivelyStreaming:t||!!((h=n.current)!=null&&h.isBuffering())}))}function Q({message:e,isCompletionInProgress:s,hasActiveRequest:t,conversation:a,className:r,isUserTurn:d,isFinalUserTurn:i,isWithinFirstAssistantTurns:y,turnIndex:v,isFeedbackEnabled:g,prevGroupedMessageType:n,prevGroupedMessages:l,citableMessages:x,superWidgetContent:o,isSteeringEnabledTurn:f,isFinalTurn:h}){var M,D,I;const c=u.useMemo(()=>"parts"in e.content?e.content.parts:[X(e)],[e]);return m.jsxs(m.Fragment,{children:[m.jsx(Y,{parts:c,messages:[e],hasActiveRequest:t,isCompletionInProgress:s,className:r,citations:(M=e.metadata)==null?void 0:M.citations,contentReferences:(D=e.metadata)==null?void 0:D.content_references,attachments:(I=e.metadata)==null?void 0:I.attachments,isUserTurn:d,isFinalUserTurn:i,isWithinFirstAssistantTurns:y,turnIndex:v,id:e.id,isFeedbackEnabled:g,conversation:a,prevGroupedMessageType:n,prevGroupedMessages:l,citableMessages:x,superWidgetContent:o}),!1,f&&s&&h&&e.status==="finished_successfully"&&e.channel==="commentary"&&m.jsx(H,{className:"mt-1"})]})}const ne=U.memo(Q);function Y(e){var o;const s=e.messages.length>1,t=$.isLastActorMessage(G(e.conversation.id),e.messages[0].id),a=J(e.conversation.id,f=>!!(f!=null&&f.sharedConversationMetadata)),r=s?void 0:z(e.messages[0],t,e.isCompletionInProgress||e.hasActiveRequest,a),d=e.messages[e.messages.length-1],i=((o=d==null?void 0:d.metadata)==null?void 0:o.chime_version)&&(d==null?void 0:d.status)==="finished_successfully",y=(r==null?void 0:r.flagSeverity)!=="danger"&&e.isCompletionInProgress&&!i,v=!e.parts.some(f=>f!==""),{bufferType:g,wordFadeType:n}=N(),[l,x]=u.useState(()=>n!=="indexed"&&g!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||v&&!r));return r&&l&&x(!1),l?m.jsx(K,P(A({},e),{bufferType:g,isActivelyStreaming:y,errorState:r})):m.jsx(E,P(A({},e),{displayParts:O({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:y,errorState:r}))}export{Y as T,ne as a};
//# sourceMappingURL=db62250d-eyec17b70eqxu45z.js.map
